[SERVICE]
    Flush        5
    Daemon       off
    Log_Level    info
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020
    storage.path              /tmp/flb-storage/
    storage.sync              normal
    storage.checksum          off
    storage.backlog.mem_limit 5M

[INPUT]
    Name              tail
    Path              /fluent-bit/logs/*.log
    Parser            constitutional_json
    Tag               acgs.constitutional.*
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    storage.type      filesystem

[INPUT]
    Name              tail
    Path              /fluent-bit/logs/constitutional/*.log
    Parser            constitutional_json
    Tag               acgs.constitutional.specific.*
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    storage.type      filesystem

[PARSER]
    Name        constitutional_json
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

[FILTER]
    Name    record_modifier
    Match   acgs.constitutional.*
    Record  constitutional_hash cdd01ef066bc6cf2
    Record  log_source constitutional_aggregator
    Record  compliance_validated true

[FILTER]
    Name    grep
    Match   acgs.constitutional.*
    Regex   constitutional_hash cdd01ef066bc6cf2

[FILTER]
    Name    lua
    Match   acgs.constitutional.*
    script  /fluent-bit/scripts/constitutional_enrichment.lua
    call    enrich_constitutional_log

[OUTPUT]
    Name  stdout
    Match acgs.constitutional.*
    Format json_lines

[OUTPUT]
    Name  file
    Match acgs.constitutional.*
    Path  /fluent-bit/logs/aggregated/
    File  constitutional_logs.json
    Format json_lines
