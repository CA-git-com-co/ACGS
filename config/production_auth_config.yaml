# ACGS-1 Production Authentication & Authorization Configuration
# Enhanced security configuration for constitutional governance system

# JWT Configuration
jwt:
  secret_key: '${SECRET_KEY}'
  algorithm: 'HS256'
  access_token_expire_minutes: 30 # Reduced for security
  refresh_token_expire_days: 7

  # Service-to-service authentication
  service_secret_key: '${SERVICE_SECRET_KEY}'
  service_token_expire_minutes: 60

# Password Security
password:
  bcrypt_rounds: 12 # Optimized for performance vs security
  min_length: 12
  require_uppercase: true
  require_lowercase: true
  require_numbers: true
  require_special_chars: true

# Session Management
session:
  timeout_minutes: 60
  max_concurrent_sessions: 5
  secure_cookies: true
  same_site: 'strict'

# Account Security
account_security:
  max_login_attempts: 5
  lockout_duration_minutes: 30
  password_reset_token_expire_minutes: 15
  email_verification_required: true

# Multi-Factor Authentication
mfa:
  enabled: true
  required_for_admin: true
  required_for_constitutional_council: true
  totp_issuer: 'ACGS Constitutional Governance'
  backup_codes_count: 10

# Role-Based Access Control
rbac:
  # Administrative roles
  system_admin:
    description: 'Full system administration access'
    permissions:
      - 'constitutional:admin'
      - 'policy:approve'
      - 'governance:oversee'
      - 'system:admin'
      - 'service:manage'
      - 'audit:access'
      - 'wina:oversight'
      - 'wina:intervention'

  constitutional_admin:
    description: 'Constitutional governance administration'
    permissions:
      - 'constitutional:read'
      - 'constitutional:write'
      - 'constitutional:admin'
      - 'policy:approve'
      - 'governance:oversee'

  # Governance roles
  constitutional_council:
    description: 'Constitutional Council member'
    permissions:
      - 'constitutional:read'
      - 'constitutional:write'
      - 'policy:review'
      - 'policy:approve'
      - 'governance:participate'

  policy_analyst:
    description: 'Policy analysis and creation'
    permissions:
      - 'constitutional:read'
      - 'policy:create'
      - 'policy:review'
      - 'governance:participate'

  governance_reviewer:
    description: 'Governance process reviewer'
    permissions:
      - 'constitutional:read'
      - 'policy:review'
      - 'governance:participate'

  # Service roles
  service_account:
    description: 'Service account for automated processes'
    permissions:
      - 'governance:participate'

  internal_service:
    description: 'Internal service-to-service communication'
    permissions:
      - 'governance:participate'
      - 'service:internal'

  # Public access
  authenticated_user:
    description: 'Authenticated user with basic access'
    permissions:
      - 'constitutional:read'
      - 'governance:participate'

  public_guest:
    description: 'Public guest access'
    permissions:
      - 'constitutional:read'

# Service-Specific Authentication
services:
  auth_service:
    port: 8000
    auth_required: false # Auth service manages its own authentication
    public_endpoints:
      - '/health'
      - '/api/v1/auth/login'
      - '/api/v1/auth/register'
      - '/api/v1/auth/refresh'

  ac_service:
    port: 8001
    auth_required: true
    public_endpoints:
      - '/health'
      - '/api/v1/constitution/public'
    required_permissions:
      - 'constitutional:read'

  integrity_service:
    port: 8002
    auth_required: true
    public_endpoints:
      - '/health'
    required_permissions:
      - 'audit:access'

  fv_service:
    port: 8003
    auth_required: true
    public_endpoints:
      - '/health'
    required_permissions:
      - 'policy:review'

  gs_service:
    port: 8004
    auth_required: true
    public_endpoints:
      - '/health'
    required_permissions:
      - 'policy:create'

  pgc_service:
    port: 8005
    auth_required: true
    public_endpoints:
      - '/health'
      - '/api/v1/policies/public'
    required_permissions:
      - 'policy:enforce'

  ec_service:
    port: 8006
    auth_required: true
    public_endpoints:
      - '/health'
    required_permissions:
      - 'wina:oversight'

  research_service:
    port: 8007
    auth_required: true
    public_endpoints:
      - '/health'
    required_permissions:
      - 'governance:participate'

# Constitutional Governance Workflows
governance_workflows:
  policy_creation:
    required_permissions:
      - 'policy:create'
      - 'constitutional:read'
    approval_required: true

  constitutional_compliance:
    required_permissions:
      - 'constitutional:read'
      - 'policy:review'
    validation_required: true

  policy_enforcement:
    required_permissions:
      - 'policy:enforce'
      - 'audit:access'
    logging_required: true

  wina_oversight:
    required_permissions:
      - 'wina:oversight'
      - 'system:admin'
    intervention_threshold: 'high'

  audit_transparency:
    required_permissions:
      - 'audit:access'
      - 'constitutional:read'
    public_access: true

# Security Headers
security_headers:
  x_content_type_options: 'nosniff'
  x_frame_options: 'DENY'
  x_xss_protection: '1; mode=block'
  strict_transport_security: 'max-age=31536000; includeSubDomains; preload'
  content_security_policy: "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
  referrer_policy: 'strict-origin-when-cross-origin'
  permissions_policy: 'geolocation=(), microphone=(), camera=()'

# Rate Limiting - Optimized for 1000 RPS target
rate_limiting:
  enabled: true
  default_requests_per_minute: 60000 # 1000 RPS with safety margin
  burst_size: 1000

  # Service-specific limits (optimized for high throughput)
  service_limits:
    auth_service: 90000 # Higher limit for auth operations
    ac_service: 60000 # Target service optimization
    pgc_service: 48000 # Higher limit for policy enforcement
    integrity_service: 36000
    fv_service: 24000
    gs_service: 60000
    ec_service: 18000

  # Role-based limits (increased for performance testing)
  role_limits:
    system_admin: 120000
    constitutional_admin: 90000
    constitutional_council: 60000
    public_guest: 6000

# Audit Logging
audit:
  enabled: true
  log_level: 'INFO'
  include_request_body: false # For privacy
  include_response_body: false

  # Events to log
  events:
    - 'authentication_success'
    - 'authentication_failure'
    - 'authorization_failure'
    - 'constitutional_change'
    - 'policy_creation'
    - 'policy_approval'
    - 'governance_action'
    - 'wina_intervention'
    - 'security_violation'

  # Retention policy
  retention_days: 365
  archive_after_days: 90

# Environment-specific overrides
environments:
  development:
    jwt:
      access_token_expire_minutes: 60 # Longer for development
    account_security:
      max_login_attempts: 10
    mfa:
      enabled: false

  staging:
    jwt:
      access_token_expire_minutes: 45
    mfa:
      enabled: true
      required_for_admin: true

  production:
    jwt:
      access_token_expire_minutes: 30
    mfa:
      enabled: true
      required_for_admin: true
      required_for_constitutional_council: true
    audit:
      log_level: 'WARNING'
      retention_days: 2555 # 7 years for compliance
