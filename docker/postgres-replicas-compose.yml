networks:
  acgs-network:
    external: true
services:
  postgres-primary:
    command:
    - postgres
    - -c
    - config_file=/etc/postgresql/postgresql.conf
    environment:
    - POSTGRES_DB=acgs_production
    - POSTGRES_USER=acgs_user
    - POSTGRES_PASSWORD=acgs_password
    - POSTGRES_REPLICATION_USER=replicator
    - POSTGRES_REPLICATION_PASSWORD=replicator_password
    image: postgres:15
    networks:
    - acgs-network
    ports:
    - 5432:5432
    volumes:
    - ./config/database/postgresql.conf:/etc/postgresql/postgresql.conf
    - postgres_primary_data:/var/lib/postgresql/data
  postgres-replica-1:
    depends_on:
    - postgres-primary
    environment:
    - PGUSER=replicator
    - POSTGRES_PASSWORD=replicator_password
    - POSTGRES_MASTER_SERVICE=postgres-primary
    - POSTGRES_REPLICA_USER=replicator
    - POSTGRES_REPLICA_PASSWORD=replicator_password
    image: postgres:15
    networks:
    - acgs-network
    ports:
    - 5433:5432
    volumes:
    - postgres_replica_1_data:/var/lib/postgresql/data
  postgres-replica-2:
    depends_on:
    - postgres-primary
    environment:
    - PGUSER=replicator
    - POSTGRES_PASSWORD=replicator_password
    - POSTGRES_MASTER_SERVICE=postgres-primary
    - POSTGRES_REPLICA_USER=replicator
    - POSTGRES_REPLICA_PASSWORD=replicator_password
    image: postgres:15
    networks:
    - acgs-network
    ports:
    - 5434:5432
    volumes:
    - postgres_replica_2_data:/var/lib/postgresql/data
  postgres-replica-3:
    depends_on:
    - postgres-primary
    environment:
    - PGUSER=replicator
    - POSTGRES_PASSWORD=replicator_password
    - POSTGRES_MASTER_SERVICE=postgres-primary
    - POSTGRES_REPLICA_USER=replicator
    - POSTGRES_REPLICA_PASSWORD=replicator_password
    image: postgres:15
    networks:
    - acgs-network
    ports:
    - 5435:5432
    volumes:
    - postgres_replica_3_data:/var/lib/postgresql/data
version: '3.8'
volumes:
  postgres_primary_data: {}
  postgres_replica_1_data: {}
  postgres_replica_2_data: {}
  postgres_replica_3_data: {}
