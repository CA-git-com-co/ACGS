apiVersion: v1
kind: ConfigMap
metadata:
  name: acge-alert-rules
  namespace: acgs-shared
  labels:
    app: prometheus
    component: alerting
    phase: phase-2
data:
  acge-alerts.yml: "groups:\n  - name: acge.constitutional.compliance\n    interval:\
    \ 30s\n    rules:\n      # Critical constitutional compliance alerts\n      -\
    \ alert: ConstitutionalComplianceCritical\n        expr: constitutional_compliance_score\
    \ < 0.95\n        for: 3m\n        labels:\n          severity: critical\n   \
    \       component: constitutional-ai\n          constitutional_hash: cdd01ef066bc6cf2\n\
    \        annotations:\n          summary: \"Constitutional compliance below critical\
    \ threshold\"\n          description: \"Constitutional compliance score is {{\
    \ $value }} for service {{ $labels.service }} in {{ $labels.environment }} environment.\
    \ Immediate action required.\"\n          runbook_url: \"https://docs.acgs.ai/runbooks/constitutional-compliance\"\
    \n\n      - alert: ConstitutionalHashMismatch\n        expr: constitutional_hash_valid\
    \ != 1\n        for: 0s\n        labels:\n          severity: critical\n     \
    \     component: constitutional-ai\n        annotations:\n          summary: \"\
    Constitutional hash validation failed\"\n          description: \"Constitutional\
    \ hash mismatch detected for service {{ $labels.service }}. Expected: cdd01ef066bc6cf2\"\
    \n          runbook_url: \"https://docs.acgs.ai/runbooks/constitutional-hash\"\
    \n\n      - alert: ACGEModelInferenceFailure\n        expr: acge_model_inference_errors_total\
    \ > 0\n        for: 1m\n        labels:\n          severity: critical\n      \
    \    component: acge-model\n        annotations:\n          summary: \"ACGE model\
    \ inference failures detected\"\n          description: \"ACGE model inference\
    \ failures: {{ $value }} errors in the last minute\"\n          runbook_url: \"\
    https://docs.acgs.ai/runbooks/acge-model\"\n\n  - name: acge.performance\n   \
    \ interval: 15s\n    rules:\n      # Performance alerts\n      - alert: ResponseTimeHigh\n\
    \        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))\
    \ > 2.0\n        for: 2m\n        labels:\n          severity: high\n        \
    \  component: performance\n        annotations:\n          summary: \"Response\
    \ time above threshold\"\n          description: \"95th percentile response time\
    \ is {{ $value }}s for service {{ $labels.service }} in {{ $labels.environment\
    \ }} environment\"\n          runbook_url: \"https://docs.acgs.ai/runbooks/performance\"\
    \n\n      - alert: ThroughputLow\n        expr: rate(http_requests_total[5m])\
    \ < 1000\n        for: 5m\n        labels:\n          severity: high\n       \
    \   component: performance\n        annotations:\n          summary: \"Throughput\
    \ below target\"\n          description: \"Request rate is {{ $value }} RPS, below\
    \ target of 1000 RPS\"\n          runbook_url: \"https://docs.acgs.ai/runbooks/throughput\"\
    \n\n      - alert: ErrorRateHigh\n        expr: rate(http_requests_total{status=~\"\
    5..\"}[5m]) / rate(http_requests_total[5m]) > 0.01\n        for: 3m\n        labels:\n\
    \          severity: high\n          component: reliability\n        annotations:\n\
    \          summary: \"Error rate above threshold\"\n          description: \"\
    Error rate is {{ $value | humanizePercentage }} for service {{ $labels.service\
    \ }}\"\n          runbook_url: \"https://docs.acgs.ai/runbooks/error-rate\"\n\n\
    \  - name: acge.blue.green.deployment\n    interval: 30s\n    rules:\n      #\
    \ Blue-green deployment alerts\n      - alert: BlueGreenTrafficImbalance\n   \
    \     expr: abs(blue_traffic_percentage - green_traffic_percentage) > 50 and blue_traffic_percentage\
    \ != 100 and green_traffic_percentage != 100\n        for: 5m\n        labels:\n\
    \          severity: warning\n          component: blue-green\n        annotations:\n\
    \          summary: \"Blue-green traffic imbalance detected\"\n          description:\
    \ \"Traffic distribution: Blue={{ $labels.blue_traffic_percentage }}%, Green={{\
    \ $labels.green_traffic_percentage }}%\"\n\n      - alert: GreenEnvironmentUnhealthy\n\
    \        expr: up{environment=\"green\"} == 0\n        for: 1m\n        labels:\n\
    \          severity: critical\n          component: blue-green\n        annotations:\n\
    \          summary: \"Green environment service down\"\n          description:\
    \ \"Service {{ $labels.service }} in green environment is down during migration\"\
    \n          runbook_url: \"https://docs.acgs.ai/runbooks/blue-green-rollback\"\
    \n\n      - alert: MigrationStalled\n        expr: increase(migration_progress_total[10m])\
    \ == 0 and migration_in_progress == 1\n        for: 10m\n        labels:\n   \
    \       severity: warning\n          component: migration\n        annotations:\n\
    \          summary: \"Migration progress stalled\"\n          description: \"\
    No migration progress detected in the last 10 minutes\"\n\n  - name: acge.infrastructure\n\
    \    interval: 30s\n    rules:\n      # Infrastructure alerts\n      - alert:\
    \ NodeResourceExhaustion\n        expr: (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)\
    \ < 0.1\n        for: 5m\n        labels:\n          severity: warning\n     \
    \     component: infrastructure\n        annotations:\n          summary: \"Node\
    \ memory exhaustion\"\n          description: \"Node {{ $labels.instance }} has\
    \ less than 10% memory available\"\n\n      - alert: PodCrashLooping\n       \
    \ expr: rate(kube_pod_container_status_restarts_total[15m]) > 0\n        for:\
    \ 5m\n        labels:\n          severity: warning\n          component: infrastructure\n\
    \        annotations:\n          summary: \"Pod crash looping\"\n          description:\
    \ \"Pod {{ $labels.pod }} in namespace {{ $labels.namespace }} is crash looping\"\
    \n\n      - alert: GPUUtilizationLow\n        expr: nvidia_gpu_utilization_gpu\
    \ < 50 and acge_model_requests_total > 0\n        for: 10m\n        labels:\n\
    \          severity: warning\n          component: gpu\n        annotations:\n\
    \          summary: \"GPU utilization low during ACGE inference\"\n          description:\
    \ \"GPU utilization is {{ $value }}% while ACGE model is receiving requests\"\n\
    \n  - name: acge.security\n    interval: 60s\n    rules:\n      # Security alerts\n\
    \      - alert: UnauthorizedAccess\n        expr: rate(http_requests_total{status=\"\
    401\"}[5m]) > 10\n        for: 2m\n        labels:\n          severity: high\n\
    \          component: security\n        annotations:\n          summary: \"High\
    \ rate of unauthorized access attempts\"\n          description: \"{{ $value }}\
    \ unauthorized access attempts per second\"\n\n      - alert: TLSCertificateExpiring\n\
    \        expr: probe_ssl_earliest_cert_expiry - time() < 86400 * 7\n        for:\
    \ 1h\n        labels:\n          severity: warning\n          component: security\n\
    \        annotations:\n          summary: \"TLS certificate expiring soon\"\n\
    \          description: \"TLS certificate for {{ $labels.instance }} expires in\
    \ {{ $value | humanizeDuration }}\"\n\n  - name: acge.data.integrity\n    interval:\
    \ 60s\n    rules:\n      # Data integrity alerts\n      - alert: DatabaseConnectionFailure\n\
    \        expr: up{job=\"postgres\"} == 0\n        for: 1m\n        labels:\n \
    \         severity: critical\n          component: database\n        annotations:\n\
    \          summary: \"Database connection failure\"\n          description: \"\
    Cannot connect to PostgreSQL database\"\n          runbook_url: \"https://docs.acgs.ai/runbooks/database\"\
    \n\n      - alert: RedisConnectionFailure\n        expr: up{job=\"redis\"} ==\
    \ 0\n        for: 1m\n        labels:\n          severity: high\n          component:\
    \ cache\n        annotations:\n          summary: \"Redis connection failure\"\
    \n          description: \"Cannot connect to Redis cache\"\n\n      - alert: DataCorruption\n\
    \        expr: data_integrity_check_failures_total > 0\n        for: 0s\n    \
    \    labels:\n          severity: critical\n          component: data-integrity\n\
    \        annotations:\n          summary: \"Data corruption detected\"\n     \
    \     description: \"Data integrity check failed: {{ $value }} failures detected\"\
    \n          runbook_url: \"https://docs.acgs.ai/runbooks/data-corruption\"\n\n\
    \  - name: acge.model.performance\n    interval: 30s\n    rules:\n      # ACGE\
    \ model performance alerts\n      - alert: ACGEModelLatencyHigh\n        expr:\
    \ histogram_quantile(0.95, rate(acge_model_inference_duration_seconds_bucket[5m]))\
    \ > 1.5\n        for: 3m\n        labels:\n          severity: warning\n     \
    \     component: acge-model\n        annotations:\n          summary: \"ACGE model\
    \ inference latency high\"\n          description: \"95th percentile ACGE model\
    \ inference latency is {{ $value }}s\"\n\n      - alert: ACGEModelMemoryUsageHigh\n\
    \        expr: acge_model_memory_usage_bytes / acge_model_memory_limit_bytes >\
    \ 0.9\n        for: 5m\n        labels:\n          severity: warning\n       \
    \   component: acge-model\n        annotations:\n          summary: \"ACGE model\
    \ memory usage high\"\n          description: \"ACGE model memory usage is {{\
    \ $value | humanizePercentage }} of limit\"\n\n      - alert: ACGEModelGPUMemoryHigh\n\
    \        expr: nvidia_gpu_memory_used_bytes / nvidia_gpu_memory_total_bytes >\
    \ 0.9\n        for: 5m\n        labels:\n          severity: warning\n       \
    \   component: gpu\n        annotations:\n          summary: \"GPU memory usage\
    \ high\"\n          description: \"GPU memory usage is {{ $value | humanizePercentage\
    \ }} for ACGE model inference\"\n"
constitutional_hash: cdd01ef066bc6cf2
