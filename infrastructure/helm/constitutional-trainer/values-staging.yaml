global:
  environment: staging
  registry: ghcr.io
  repository: ca-git-com-co/acgs
  imageTag: staging
  namespace: acgs-staging
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 200m
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  networkPolicy:
    enabled: true
    ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: acgs-staging
      ports:
      - protocol: TCP
        port: 8000
constitutionalTrainer:
  enabled: true
  image:
    repository: ghcr.io/ca-git-com-co/acgs/constitutional-trainer
    tag: staging
    pullPolicy: Always
  replicaCount: 2
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  resources:
    requests:
      memory: 2Gi
      cpu: 500m
      nvidia.com/gpu: 1
    limits:
      memory: 8Gi
      cpu: 2000m
      nvidia.com/gpu: 1
  config:
    constitutionalHash: cdd01ef066bc6cf2
    complianceThreshold: '0.95'
    maxCritiqueIterations: '3'
    maxConcurrentSessions: '10'
    enableDifferentialPrivacy: 'true'
    privacyEpsilon: '8.0'
    privacyDelta: 1e-5
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
policyEngine:
  enabled: true
  image:
    repository: ghcr.io/ca-git-com-co/acgs/policy-engine
    tag: staging
    pullPolicy: Always
  replicaCount: 2
  service:
    type: ClusterIP
    port: 8001
    targetPort: 8001
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 300m
  opa:
    enabled: true
    image:
      repository: openpolicyagent/opa
      tag: 0.58.0-envoy
    resources:
      requests:
        memory: 128Mi
        cpu: 50m
      limits:
        memory: 256Mi
        cpu: 100m
auditEngine:
  enabled: true
  image:
    repository: ghcr.io/ca-git-com-co/acgs/audit-engine
    tag: staging
    pullPolicy: Always
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8003
    targetPort: 8003
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 200m
  persistence:
    enabled: true
    storageClass: standard
    size: 10Gi
    accessMode: ReadWriteOnce
redis:
  enabled: true
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 6379
    targetPort: 6379
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 100m
  config:
    maxmemory: 200mb
    maxmemoryPolicy: allkeys-lru
  persistence:
    enabled: true
    storageClass: standard
    size: 5Gi
    accessMode: ReadWriteOnce
monitoring:
  enabled: true
  prometheus:
    enabled: true
    image:
      repository: prom/prometheus
      tag: v2.47.0
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 200m
    persistence:
      enabled: true
      size: 10Gi
  grafana:
    enabled: true
    image:
      repository: grafana/grafana
      tag: 10.1.0
    resources:
      requests:
        memory: 128Mi
        cpu: 50m
      limits:
        memory: 256Mi
        cpu: 100m
    persistence:
      enabled: true
      size: 5Gi
    adminUser: admin
    adminPassword: os.environ.get("PASSWORD")
    dashboards:
    - name: constitutional-trainer-overview
      file: constitutional-trainer-overview.json
    - name: load-testing-dashboard
      file: constitutional-trainer-load-testing.json
ingress:
  enabled: true
  className: nginx
  hosts:
  - host: constitutional-trainer-staging.acgs.local
    paths:
    - path: /
      pathType: Prefix
      service:
        name: constitutional-trainer
        port: 8000
  - host: policy-engine-staging.acgs.local
    paths:
    - path: /
      pathType: Prefix
      service:
        name: policy-engine
        port: 8001
  - host: audit-engine-staging.acgs.local
    paths:
    - path: /
      pathType: Prefix
      service:
        name: audit-engine
        port: 8003
  tls:
  - secretName: acgs-staging-tls
    hosts:
    - constitutional-trainer-staging.acgs.local
    - policy-engine-staging.acgs.local
    - audit-engine-staging.acgs.local
serviceMesh:
  enabled: false
  virtualService:
    enabled: false
  destinationRule:
    enabled: false
  peerAuthentication:
    enabled: false
security:
  podSecurityPolicy:
    enabled: true
  networkPolicy:
    enabled: true
  rbac:
    enabled: true
    serviceAccount:
      create: true
      name: constitutional-trainer-staging
  scanning:
    enabled: true
    schedule: 0 2 * * 1
testing:
  enabled: true
  integration:
    enabled: true
    schedule: 0 */6 * * *
  loadTesting:
    enabled: true
    schedule: 0 1 * * 1
  smokeTests:
    enabled: true
    schedule: '*/15 * * * *'
backup:
  enabled: true
  database:
    enabled: true
    schedule: 0 3 * * *
    retention: 7d
  config:
    enabled: true
    schedule: 0 4 * * *
    retention: 30d
logging:
  enabled: true
  level: DEBUG
  aggregation:
    enabled: true
    endpoint: http://elasticsearch:9200
  retention:
    days: 30
alerting:
  enabled: true
  alertmanager:
    enabled: true
  notifications:
    slack:
      enabled: true
      webhook: https://hooks.slack.com/services/staging-webhook
      channel: '#acgs-staging-alerts'
    email:
      enabled: true
      smtp:
        host: smtp.company.com
        port: 587
        username: alerts@company.com
      recipients:
      - staging-team@company.com
featureFlags:
  enableExperimentalFeatures: true
  enableDebugEndpoints: true
  enableMetricsCollection: true
  enableTracing: true
  enableChaosEngineering: false
annotations:
  deployment.kubernetes.io/revision: '1'
  acgs.io/environment: staging
  acgs.io/version: staging
  acgs.io/managed-by: helm
labels:
  environment: staging
  tier: application
  component: constitutional-trainer
  version: staging
  managed-by: helm
constitutional_hash: cdd01ef066bc6cf2
