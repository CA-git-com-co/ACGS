openapi: 3.0.3
info:
  title: ACGS-1 Constitutional AI Service API
  description: |
    Constitutional AI service providing advanced constitutional compliance validation,
    formal verification integration, and real-time constitutional violation detection.
    
    Constitutional Hash: cdd01ef066bc6cf2
  version: 3.0.0
  contact:
    name: ACGS-1 Development Team
    url: https://github.com/CA-git-com-co/ACGS
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8001
    description: Local development server
  - url: https://ac.acgs.local
    description: Production server

security:
  - BearerAuth: []

paths:
  /health:
    get:
      summary: Service health check
      description: Returns the current health status of the constitutional AI service
      tags:
        - Health
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/v1/constitutional/validate:
    post:
      summary: Validate constitutional compliance
      description: Validate action or policy against constitutional principles
      tags:
        - Constitutional Compliance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConstitutionalValidationRequest'
      responses:
        '200':
          description: Validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConstitutionalValidationResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/principles:
    get:
      summary: List constitutional principles
      description: Retrieve all constitutional principles
      tags:
        - Constitutional Principles
      parameters:
        - name: category
          in: query
          schema:
            type: string
          description: Filter by principle category
        - name: active
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Principles retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrinciplesResponse'

    post:
      summary: Create constitutional principle
      description: Create a new constitutional principle
      tags:
        - Constitutional Principles
      requestBody:
        required: true
        content:

  /api/v1/dgm/sandbox/validate:
    post:
      summary: DGM sandbox validation
      description: Validate DGM operations in sandbox environment before production deployment
      tags:
        - DGM Safety Patterns
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DGMSandboxRequest'
      responses:
        '200':
          description: Sandbox validation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DGMSandboxResponse'
        '400':
          description: Invalid sandbox request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/dgm/human-review:
    post:
      summary: Request human review
      description: Submit DGM operation for human review and approval
      tags:
        - DGM Safety Patterns
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HumanReviewRequest'
      responses:
        '202':
          description: Human review request submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HumanReviewResponse'

    get:
      summary: Get human review status
      description: Retrieve status of pending human review requests
      tags:
        - DGM Safety Patterns
      parameters:
        - name: review_id
          in: query
          schema:
            type: string
            format: uuid
          description: Specific review ID to check
      responses:
        '200':
          description: Human review status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HumanReviewStatusResponse'

  /api/v1/emergency/shutdown:
    post:
      summary: Emergency shutdown
      description: Initiate emergency shutdown with <30min RTO capability
      tags:
        - Emergency Procedures
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmergencyShutdownRequest'
      responses:
        '200':
          description: Emergency shutdown initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmergencyShutdownResponse'
        '403':
          description: Insufficient permissions for emergency shutdown
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/rollback:
    post:
      summary: Rollback to safe state
      description: Rollback system to previous safe constitutional state
      tags:
        - DGM Safety Patterns
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RollbackRequest'
      responses:
        '200':
          description: Rollback completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RollbackResponse'
        '400':
          description: Invalid rollback request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePrincipleRequest'
      responses:
        '201':
          description: Principle created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrincipleResponse'

  /api/v1/principles/{principle_id}:
    get:
      summary: Get constitutional principle
      description: Retrieve specific constitutional principle
      tags:
        - Constitutional Principles
      parameters:
        - name: principle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Principle retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrincipleResponse'

    put:
      summary: Update constitutional principle
      description: Update existing constitutional principle
      tags:
        - Constitutional Principles
      parameters:
        - name: principle_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePrincipleRequest'
      responses:
        '200':
          description: Principle updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrincipleResponse'

  /api/v1/constitutional-council/members:
    get:
      summary: List council members
      description: Get constitutional council members
      tags:
        - Constitutional Council
      responses:
        '200':
          description: Council members retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CouncilMembersResponse'

  /api/v1/constitutional-council/proposals:
    get:
      summary: List constitutional proposals
      description: Get all constitutional proposals
      tags:
        - Constitutional Council
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, review, voting, approved, rejected]
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Proposals retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProposalsResponse'

    post:
      summary: Submit constitutional proposal
      description: Submit new constitutional proposal for review
      tags:
        - Constitutional Council
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProposalRequest'
      responses:
        '201':
          description: Proposal submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProposalResponse'

  /api/v1/constitutional-council/vote:
    post:
      summary: Cast vote on proposal
      description: Cast vote on constitutional proposal
      tags:
        - Constitutional Council
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        '200':
          description: Vote cast successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'

  /api/v1/compliance/status:
    get:
      summary: Get compliance status
      description: Get overall constitutional compliance status
      tags:
        - Compliance Monitoring
      responses:
        '200':
          description: Compliance status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceStatusResponse'

  /api/v1/compliance/violations:
    get:
      summary: Get constitutional violations
      description: Retrieve recent constitutional violations
      tags:
        - Compliance Monitoring
      parameters:
        - name: since
          in: query
          schema:
            type: string
            format: date-time
          description: Get violations since this timestamp
        - name: severity
          in: query
          schema:
            type: string
            enum: [low, medium, high, critical]
      responses:
        '200':
          description: Violations retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViolationsResponse'

  /api/v1/fidelity/metrics:
    get:
      summary: Get constitutional fidelity metrics
      description: Retrieve constitutional fidelity and adherence metrics
      tags:
        - Monitoring
      responses:
        '200':
          description: Fidelity metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FidelityMetricsResponse'

  /metrics:
    get:
      summary: Prometheus metrics
      description: Service metrics for monitoring
      tags:
        - Monitoring
      security: []
      responses:
        '200':
          description: Metrics data
          content:
            text/plain:
              schema:
                type: string

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
        service:
          type: string
          example: ac_service
        version:
          type: string
          example: "3.0.0"
        constitutional_hash:
          type: string
          example: "cdd01ef066bc6cf2"
        timestamp:
          type: string
          format: date-time

    ConstitutionalValidationRequest:
      type: object
      required:
        - action
        - context
      properties:
        action:
          type: string
          description: Action to validate
          example: "policy_creation"
        context:
          type: object
          properties:
            policy_id:
              type: string
            user_id:
              type: string
            metadata:
              type: object
        validation_level:
          type: string
          enum: [basic, comprehensive]
          default: basic

    ConstitutionalValidationResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          type: object
          properties:
            validation_result:
              type: object
              properties:
                compliant:
                  type: boolean
                confidence:
                  type: number
                  minimum: 0
                  maximum: 1
                hash_valid:
                  type: boolean
                principles_checked:
                  type: integer
                violations:
                  type: array
                  items:
                    type: object
            constitutional_hash:
              type: string
              example: "cdd01ef066bc6cf2"
            timestamp:
              type: string
              format: date-time

    CreatePrincipleRequest:
      type: object
      required:
        - title
        - description
        - category
      properties:
        title:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        category:
          type: string
          enum: [democratic_process, transparency, accountability, privacy, fairness]
        priority:
          type: integer
          minimum: 1
          maximum: 10
        enforcement_level:
          type: string
          enum: [advisory, mandatory, constitutional]

    PrincipleResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
            title:
              type: string
            description:
              type: string
            category:
              type: string
            priority:
              type: integer
            enforcement_level:
              type: string
            active:
              type: boolean
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        constitutional_hash:
          type: string
          example: "cdd01ef066bc6cf2"
        timestamp:
          type: string
          format: date-time

    DGMSandboxRequest:
      type: object
      required:
        - operation_type
        - parameters
      properties:
        operation_type:
          type: string
          enum: [policy_generation, constitutional_update, governance_change]
          description: Type of DGM operation to validate
        parameters:
          type: object
          description: Operation-specific parameters
        safety_threshold:
          type: number
          minimum: 0.0
          maximum: 1.0
          default: 0.95
          description: Required safety threshold for validation
        constitutional_hash:
          type: string
          example: cdd01ef066bc6cf2
          description: Constitutional hash for compliance validation

    DGMSandboxResponse:
      type: object
      properties:
        validation_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [passed, failed, requires_review]
        safety_score:
          type: number
          minimum: 0.0
          maximum: 1.0
        constitutional_compliance:
          type: boolean
        violations:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
              severity:
                type: string
                enum: [low, medium, high, critical]
              description:
                type: string
        recommendations:
          type: array
          items:
            type: string

    HumanReviewRequest:
      type: object
      required:
        - operation_id
        - operation_type
        - priority
      properties:
        operation_id:
          type: string
          format: uuid
        operation_type:
          type: string
          enum: [constitutional_change, high_risk_policy, emergency_override]
        priority:
          type: string
          enum: [low, medium, high, critical]
        description:
          type: string
          maxLength: 1000
        context:
          type: object
          description: Additional context for human reviewers
        deadline:
          type: string
          format: date-time
          description: Review deadline (if applicable)

    HumanReviewResponse:
      type: object
      properties:
        review_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [submitted, in_review, approved, rejected, escalated]
        estimated_completion:
          type: string
          format: date-time
        reviewer_assigned:
          type: boolean
        tracking_url:
          type: string
          format: uri

    EmergencyShutdownRequest:
      type: object
      required:
        - reason
        - authorization_code
      properties:
        reason:
          type: string
          maxLength: 500
          description: Reason for emergency shutdown
        authorization_code:
          type: string
          description: Emergency authorization code
        scope:
          type: string
          enum: [service, system, full]
          default: service
          description: Scope of emergency shutdown
        preserve_data:
          type: boolean
          default: true
          description: Whether to preserve data during shutdown

    EmergencyShutdownResponse:
      type: object
      properties:
        shutdown_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [initiated, in_progress, completed, failed]
        estimated_rto:
          type: string
          description: Estimated Recovery Time Objective (<30min)
        affected_services:
          type: array
          items:
            type: string
        recovery_instructions:
          type: string

    RollbackRequest:
      type: object
      required:
        - target_state
      properties:
        target_state:
          type: string
          description: Target state identifier or timestamp
        reason:
          type: string
          maxLength: 500
        preserve_recent_data:
          type: boolean
          default: false
        validation_required:
          type: boolean
          default: true

    RollbackResponse:
      type: object
      properties:
        rollback_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [initiated, in_progress, completed, failed]
        target_state:
          type: string
        rollback_time:
          type: string
          format: date-time
        affected_components:
          type: array
          items:
            type: string
        validation_results:
          type: object

tags:
  - name: Health
    description: Service health and status endpoints
  - name: Constitutional Compliance
    description: Constitutional validation and compliance checking
  - name: Constitutional Principles
    description: Management of constitutional principles
  - name: Constitutional Council
    description: Constitutional council operations and voting
  - name: Compliance Monitoring
    description: Compliance status and violation monitoring
  - name: DGM Safety Patterns
    description: DGM sandbox validation, human review, and rollback mechanisms
  - name: Emergency Procedures
    description: Emergency shutdown and recovery procedures (<30min RTO)
  - name: Monitoring
    description: Service monitoring and metrics
