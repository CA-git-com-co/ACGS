# 2402.05749_Generalized-Preference-Optimization-A-Unified-Appr

**Original PDF**: 2402.05749_Generalized-Preference-Optimization-A-Unified-Appr.pdf
**Conversion Method**: PyMuPDF
**Constitutional Hash**: cdd01ef066bc6cf2

---

## Page 1

Generalized Preference Optimization: A

Unified Approach to Offline Alignment

Yunhao Tangğ›½, Zhaohan Daniel Guoğ›½, Zeyu Zhengğ›½, Daniele Calandrielloğ›½, RÃ©mi Munosğ›½, Mark Rowlandğ›½,

Pierre Harvey Richemondğ›½, Michal Valkoğ›½, Bernardo Ãvila Piresğ›½and Bilal Piotğ›½

ğ›½Google DeepMind

Offline preference optimization allows fine-tuning large models directly from offline data, and has

proved effective in recent alignment practices. We propose generalized preference optimization (GPO),

a family of offline losses parameterized by a general class of convex functions. GPO enables a unified

view over preference optimization, encompassing existing algorithms such as DPO, IPO and SLiC as

special cases, while naturally introducing new variants. The GPO framework also sheds light on how

offline algorithms enforce regularization, through the design of the convex function that defines the

loss. Our analysis and experiments reveal the connections and subtle differences between the offline

regularization and the KL divergence regularization intended by the canonical RLHF formulation. In a

controlled setting akin to Gao et al. (2023), we also show that different GPO variants achieve similar

trade-offs between regularization and performance, though the optimal values of hyper-parameter might

differ as predicted by theory. In all, our results present new algorithmic toolkits and empirical insights

to alignment practitioners.

1. Introduction

Reinforcement learning from human feedback (RLHF) has been a canonical paradigm for aligning

powerful AI systems along human values (Christiano et al., 2017; Ouyang et al., 2022), as demon-

strated by recent advances in large language models (LLMs) (Achiam et al., 2023; Team et al., 2023).

RLHF consists of two steps: reward modeling, which trains a reward model ğ‘Ÿğœ™to capture human

preferences from a dataset of pairwise comparison; and regularized policy optimization, which aligns

the AI systems against the learned reward model, more formally as below

max

ğœƒ

ğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ



ğ‘Ÿğœ™(ğ‘¦)



|           {z           }

reward maximization

âˆ’ğ›½ğ•‚ğ•ƒ(ğœ‹ğœƒ, ğœ‹ref)

|          {z          }

regularization

.

Lately, directly aligning AI systems from pairwise comparison datasets has become increasingly

common (e.g., Azar et al., 2024; Rafailov et al., 2023; Zhao et al., 2023), as evidenced by progress in

open source models (e.g., Jiang et al., 2024). Compared to canonical RL algorithms, such methods

are more computationally efficient as they do not require expensive sampling from the models. They

also avoid learning reward models altogether, and effectively replace RLHF with a supervised learning

problem, which is convenient from various practical perspectives. We refer to such methods as offline

preference optimization, as they seek to optimize human preferences using offline datasets. Here,

offline stresses the fact that such datasets are not generated by interactive data collections from the

learned model.

Our first contribution is to provide a unifying view over notable existing offline preference optimization

algorithms, such as DPO (Rafailov et al., 2023), IPO (Azar et al., 2024) and SLiC (Zhao et al., 2023).

To this end, we propose GPO (Generalized Preference Optimization), which parameterizes preference

optimization losses via a family of convex functions ğ‘“, with DPO, IPO, and SLiC as special cases (see

Figure 1 for a preview of the instantiations). The central insight to our derivation is that one can

arXiv:2402.05749v2  [cs.LG]  28 May 2024

## Page 2

Generalized Preference Optimization: A Unified Approach to Offline Alignment

1.0

0.5

0.0

0.5

1.0

1.5

2.0

0.00

0.25

0.50

0.75

1.00

1.25

1.50

1.75

2.00

f( )

## Dpo

## Ipo

## Slic

0-1

Figure 1 | Illustration of offline preference optimization losses ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ ğ‘“(ğœŒğœƒ)] as a function of the difference

of log ratio ğœŒğœƒ= log ğœ‹ğœƒ(ğ‘¦ğ‘¤)/ğœ‹ref(ğ‘¦ğ‘¤) âˆ’log ğœ‹ğœƒ(ğ‘¦ğ‘™)/ğœ‹ref(ğ‘¦ğ‘™). DPO applies the (scaled) logistic loss

1

log 2 log(1 +

exp(âˆ’ğœŒğœƒ)), SLiC applies the hinge loss max(0, 1 âˆ’ğœŒğœƒ), while IPO applies the squared loss (ğœŒğœƒâˆ’1)2. As a

result, many popular offline losses can be understood as convex approximations to the 0-1 loss that measures

the binary classification accuracy. Any other convex loss alternatives to the above examples provide offline

preference optimization losses not in the existing literature, as we show in Table 1.

interpret the problem of reward modeling as a supervised binary classification problem (Hastie et al.,

2009). The rich literature on supervised binary classification paves the way to unifying existing offline

preference optimization algorithms, and naturally introduces new algorithms not yet in the current

literature. The GPO formulation also helps better understand the algorithmic trade-offs between

different variants, particularly, the strength of regularization, which we further dive into.

With a unifying view over offline preference optimization algorithms, our second contribution is to

dive into the regularization mechanism induced by offline losses. We see that the tail behavior of the

convex function ğ‘“, governs the effective strength of regularization induced between ğœ‹ğœƒand ğœ‹ref, which

offers insight on the choice of hyper-parameters such as ğ›½. We identify the offline regularization,

computed based on the offline dataset, and show how it generally differs from the KL divergence

intended in the initial formulation. Our analysis and empirical results hint at some challenges to

enforcing the KL divergence constraints with offline losses, revealing some of the subtleties of the

â€˜equivalenceâ€™ arguments adopted in prior work to derive offline losses (see also Theorem 1 for a more

general version of the equivalence argument).

The paper is organized as follows:

â€¢ In Section 2, we present GPO, generalized policy optimization, which parameterizes offline

preference optimization algorithms through a convex function. This recovers a few popular

algorithms as special cases and offers insights to offline alignment algorithms in general.

â€¢ In Section 3, we expand on the derivation of reward modeling as a binary classification problem.

Our insight allows for connecting a rich literature on supervised classification to the designs of

offline alignment, which paves the way to the GPO formulation.

â€¢ In Section 4, we dive into how offline preference optimization induces regularization between ğœ‹ğœƒ

and ğœ‹ref during optimization. We identify an offline regularization loss, the effective regularization

that offline algorithms enforce, and show how it differs from the KL divergence through analysis

2

## Page 3

Generalized Preference Optimization: A Unified Approach to Offline Alignment

and experimental study. We also show how the design of ğ‘“introduces different strength of

regularization, and how hyper-parameters should be chosen adaptive to ğ‘“.

â€¢ In Section 5, we start with a controlled setting akin to Gao et al. (2023) and show the regularization

vs. performance trade-off for different GPO variants. By varying ğ›½and learning stages during

training, the policy performance initially increases followed by decrease, as predicted by the

Goodhartâ€™s law. We observe similar trade-offs across different GPO variants, though the best

hyper-parameter can differ significantly due to different inherent strengths of the regularization,

as suggested by theory. In a LLM summarization task, we also confirm similar performance across

different GPO variants (up to tuning in ğ›½).

2. A general family of offline preference optimization losses

In the case of language model alignment, we optimize a policy ğœ‹ğœƒthat outputs response ğ‘¦âˆ¼ğœ‹ğœƒ(Â·|ğ‘¥)

given prompt ğ‘¥. Given two responses ğ‘¦, ğ‘¦â€² âˆˆY, a human rater provides feedback by picking out the

preferred response. This allows relabeling the two responses as (ğ‘¦ğ‘¤, ğ‘¦ğ‘™) corresponding to the win-loss

responses. Such pairwise preference data is usually collected offline and can come from a variety of

sources in practice, which we denote as a behavior policy ğœ‡. Henceforth, when the context is clear we

remove the dependency on the prompt ğ‘¥for simplicity.

Importantly, we do not make any assumption on the preference structure ğ‘(ğ‘¦â‰»ğ‘¦â€²), e.g., it may not

come from a Bradley-Terry (BT) model (Bradley and Terry, 1952), a common assumption made in

prior work (Rafailov et al., 2023). Below, we unify ways to derive various existing offline preference

optimization losses for learning from pairwise human feedback.

2.1. A recipe to derive preference optimization losses

Assuming access to a reward function ğ‘Ÿğœ™, the regularized policy optimization objective (Ouyang et al.,

2022) is

max

ğœ‹ğœƒğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ



ğ‘Ÿğœ™(ğ‘¦)



âˆ’ğ›½ğ•‚ğ•ƒ(ğœ‹ğœƒ, ğœ‹ref) .

(1)

To be clear about the KL definition, we have for any two distributions ğœ‹, ğœ‹â€²: ğ•‚ğ•ƒ(ğœ‹, ğœ‹â€²) B ğ”¼ğ‘¦âˆ¼ğœ‹

h

log ğœ‹(ğ‘¦)

ğœ‹â€²(ğ‘¦)

i

.

The solution to the regularized objective above can be written analytically as ğœ‹âˆ—

ğœƒ(ğ‘¦) âˆğœ‹ref(ğ‘¦) exp  ğ›½âˆ’1ğ‘Ÿğœ™(ğ‘¦).

Given a pair of responses (ğ‘¦ğ‘¤, ğ‘¦ğ‘™), we can train the reward model ğ‘Ÿğœ™through supervised learning. A

convenient class of loss function is defined through the difference ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™): we can think of

ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™) as predicting how likely ğ‘¦ğ‘¤is preferred to ğ‘¦ğ‘™. From the discussion above, we see that

this difference is equivalent to the log ratio difference of the optimal policy to Eqn (1)

ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™) = ğ›½



log

ğœ‹âˆ—

ğœƒ(ğ‘¦ğ‘¤)

ğœ‹ref(ğ‘¦ğ‘¤) âˆ’log

ğœ‹âˆ—

ğœƒ(ğ‘¦ğ‘™)

ğœ‹ref(ğ‘¦ğ‘™)



.

(2)

Hence intuitively, any loss defined through the reward difference ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™) can introduce a loss

over ğœ‹ğœƒ.

A central insight of this work is framing reward learning as a supervised binary classification problem.

We leave a more detailed derivation to Section 3, which provides additional insights. Letting ğ‘“: â„â†’â„

be a scalar function, in general the reward learning loss (to be minimized) can be written as

ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡



ğ‘“ ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™)

.

(3)

Before moving on, note that the difference ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™) is reminiscent of the BT model assump-

tion. However, we argue that it is more sensible to relate this parametric form to the fact that the

3

## Page 4

Generalized Preference Optimization: A Unified Approach to Offline Alignment

Table 1 | Side-by-side correspondence between existing offline preference optimization losses and

convex supervised learning losses. Among a rich variety of convex supervised learning losses developed

in the literature, logistic log loss (Hastie et al., 2009), hinge loss (Cortes and Vapnik, 1995) and

squared loss (Rosasco et al., 2004) have offline preference optimization algorithmic counterparts.

Other notable losses, such as the exponential loss (Freund and Schapire, 1995), truncated quadratic

loss (Bartlett et al., 2006) and Savage loss (Masnadi-Shirazi and Vasconcelos, 2008) can form novel

offline preference optimization algorithms.

Supervised learning losses

ğ‘“(ğ›½ğœŒğœƒ)

Offline preference optimization

Logistic log loss

log (1 + exp(âˆ’ğ›½ğœŒğœƒ))

DPO (Rafailov et al., 2023)

Hinge loss

max (0, 1 âˆ’ğ›½ğœŒğœƒ)

SLiC (Zhao et al., 2023)

squared loss

(ğ›½ğœŒğœƒâˆ’1)2

IPO (Azar et al., 2024)

Exponential loss

exp(âˆ’ğ›½ğœŒğœƒ)

## N/A

Truncated quadratic loss

(max(0, 1 âˆ’ğ›½ğœŒğœƒ))2

## N/A

Savage loss

1/(1 + exp(ğ›½ğœŒğœƒ))2

## N/A

RLHF formulation (Eqn 1) is a maximization problem, and hence imply that each response can be

characterized as a single scalar ğ‘Ÿğœ™(ğ‘¦). We provide a more detailed discussion in Section 3.

Many existing offline preference optimization losses can be cast in this general form by replacing the

reward difference by the log ratio difference,

ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡



ğ‘“



ğ›½Â·



log ğœ‹ğœƒ(ğ‘¦ğ‘¤)

ğœ‹ref(ğ‘¦ğ‘¤) âˆ’log ğœ‹ğœƒ(ğ‘¦ğ‘™)

ğœ‹ref(ğ‘¦ğ‘™)



.

(4)

Henceforth, we denote the log ratio difference as ğœŒğœƒB log ğœ‹ğœƒ(ğ‘¦ğ‘¤)

ğœ‹ref(ğ‘¦ğ‘¤) âˆ’log ğœ‹ğœƒ(ğ‘¦ğ‘™)

ğœ‹ref(ğ‘¦ğ‘™) and the above loss can

be rewritten as ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ ğ‘“(ğ›½ğœŒğœƒ)]. A general recipe to derive offline preference optimization losses

is to start with a supervised learning loss function ğ‘“for reward learning, and replace the reward

difference by ğœŒğœƒ(see, e.g., Hastie et al., 2009 for a nice overview of such loss functions). We can

identify the specific functions ğ‘“for the most common choices; see illustrations of the losses in Figure 1

with ğ›½= 1.

â€¢ DPO: ğ‘“(ğ›½ğœŒğœƒ) = âˆ’log ğœ(ğ›½ğœŒğœƒ) with ğœbeing the sigmoid function, applies the logistic loss (Hastie

et al., 2009). The loss can also be written as log(1 + exp(âˆ’ğ›½ğœŒğœƒ)).

â€¢ IPO: ğ‘“(ğ›½ğœŒğœƒ) = (ğ›½ğœŒğœƒâˆ’1)2, the squared function (Rosasco et al., 2004), can be understood as

applying linear regression to the probability that ğ‘¦ğ‘¤is preferred (Hastie et al., 2009).

â€¢ SLiC: ğ‘“(ğ›½ğœŒğœƒ) = max(0, 1âˆ’ğ›½ğœŒğœƒ) is the hinge loss function, stemming from the max-margin (support

vector machine) paradigm (Boser et al., 1992; Cortes and Vapnik, 1995). The original SliC

algorithm (Zhao et al., 2023) also includes a supervised learning component, which we do not

discuss here.

2.2. GPO: A generalized family of offline preference optimization algorithms

Building on the discussion above, in general, any properly defined supervised learning loss ğ‘“for

reward modeling can translate into a preference optimization objective ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ ğ‘“(ğ›½ğœŒğœƒ)]. We provide

a table of a few notable supervised learning losses developed in the decades-old literature, each loss

mapping into an offline preference optimization algorithm.

As discussed above, some of them have already translated into existing methods. We note a few

examples without offline preference optimization counterparts:

4

## Page 5

Generalized Preference Optimization: A Unified Approach to Offline Alignment

1.0

0.5 0.0

0.5

1.0

1.5

2.0

2.5

3.0

0.00

0.25

0.50

0.75

1.00

1.25

1.50

1.75

2.00

f( )

Logistic

Squared

Hinge

Exponential

Truncated squared

Savage

0-1

Figure 2 | Illustration of notable examples of binary classification loss functions, including both examples

(logistic, squared and hinge) that have led to existing offline preference optimization algorithms, as well as

others (exponential, truncated squared, Savage) that produce novel losses.

â€¢ Exponential loss: ğ‘“(ğ›½ğœŒğœƒ) = exp(âˆ’ğ›½ğœŒğœƒ), the loss function for the AdaBoost algorithm (Freund and

Schapire, 1995).

â€¢ Truncated quadratic: ğ‘“(ğ›½ğœŒğœƒ) = (max (0, 1 âˆ’ğ›½ğœŒğœƒ))2 (Bartlett et al., 2006), a truncated variant of

the squared loss, is also a smooth approximation to the hinge loss.

â€¢ Savage loss: ğ‘“(ğ›½ğœŒğœƒ) = 1/(1 + exp(ğ›½ğœŒğœƒ))2 (Masnadi-Shirazi and Vasconcelos, 2008) which have

proved robust to outliers in data and found applications in boosting algorithms.

Bartlett et al. (2006); Rosasco et al. (2004) give a more exhaustive list of convex supervised learning

losses and their discussions.

A key motivating argument for the offline preference optimization algorithms (Azar et al., 2024;

Rafailov et al., 2023; Zhao et al., 2023) is that minimizing the offline losses for the policy ğœ‹ğœƒis

equivalent to obtaining the optimal regularized policy against a loss minimizing reward model. We

can extend the conclusion to this general family of offline preference optimization algorithms.

Theorem 1. (Equivalence of optimal solutions) Let ğœ‹âˆ—

ğœƒbe the global minimizer of the offline

preference optimization loss in Eqn (4). ğœ‹âˆ—

ğœƒis the same as the optimal regularized policy (according

to Eqn (1)) for a reward function that globally minimizes the loss Eqn (3).

3. Reward modeling viewed as a binary classification problem

Here, we take a step back and dive into the derivation that converts reward modeling into a supervised

binary classification problem. We provide a brief background on the basic setup, and how it relates to

reward modeling (see, e.g., Hastie et al., 2009 for a more comprehensive introduction).

In binary classification, given a pair of feature and label (ğ‘§, ğ‘™) with ğ‘§âˆˆâ„ğ‘˜and ğ‘™âˆˆ{âˆ’1, 1}, the

aim is to predict Ë†â„“(ğ‘§) âˆˆâ„as a function of the feature, and use sign



Ë†â„“(ğ‘§)



as the classifier, in the

hope that it can match the ground truth label ğ‘¦. The classification accuracy can be written as

5

## Page 6

Generalized Preference Optimization: A Unified Approach to Offline Alignment

1

## 2ğ”¼

h

sign



Ë†â„“(ğ‘§) Â· ğ‘™

i

+ 1

2 âˆˆ[0, 1] and an equivalent loss function is

## ğ”¼

h

1 âˆ’sign



Ë†â„“(ğ‘§) Â· â„“

i

.

(5)

The above loss, known as the 0-1 loss (see the dotted dark curve in Figure 1) is non-convex. Instead

of directly optimizing it, we can take smooth convex functions ğ‘“: â„â†’â„and approximate the loss as

## ğ”¼

h

ğ‘“



Ë†â„“(ğ‘§) Â· â„“

i

.

Taking this back to the case of reward modeling, given a pair of responses (ğ‘¦1, ğ‘¦2), we construct a

sample for binary classification by setting the label â„“= 1 if ğ‘¦1 â‰»ğ‘¦2 and â„“= âˆ’1 otherwise.

Thinking of (ğ‘¦1, ğ‘¦2) as the feature from which to make prediction, in general the prediction would

be a bi-variate function Ë†â„“(ğ‘¦1, ğ‘¦2) that can depend on both ğ‘¦1 and ğ‘¦2 in an arbitrary form. For a

pointwise reward model that depends on a single response ğ‘Ÿğœ™: Y â†’â„, an intuitive parameterization

would be to take the difference of two rewards Ë†â„“(ğ‘¦1, ğ‘¦2) = ğ‘Ÿğœ™(ğ‘¦1) âˆ’ğ‘Ÿğœ™(ğ‘¦2). The corresponding binary

classification loss is

ğ”¼ğ‘¦1âˆ¼ğœ‡,ğ‘¦2âˆ¼ğœ‡



ğ•€[ğ‘¦1 â‰»ğ‘¦2] ğ‘“ ğ‘Ÿğœ™(ğ‘¦1) âˆ’ğ‘Ÿğœ™(ğ‘¦2)

+ ğ”¼ğ‘¦1âˆ¼ğœ‡,ğ‘¦2âˆ¼ğœ‡



ğ•€[ğ‘¦2 â‰»ğ‘¦1] ğ‘“ ğ‘Ÿğœ™(ğ‘¦2) âˆ’ğ‘Ÿğœ™(ğ‘¦1)

.

Equivalently, we can write the loss as in Eqn (3)

ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡



ğ‘“ ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™)

.

The above result offers a number of interesting implications, which we expand on in the next section.

3.1. Characterizing what the reward model learns

Drawing inspiration from the supervised learning literature, we can reason about properties of the

reward models obtained by minimizing the convex loss function ğ‘“. This can translate into effects on

the downstream optimized policies due to the equivalence in Eqn (2). Some discussions are in order

below.

The Bradley-Terry assumption and analytic forms of reward models.

As alluded to earlier, the

design of the reward modeling loss as a function of the reward difference ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™) should be

interpreted as a result of the reward maximization formulation of RLHF. Implicitly, the maximization

formulation assumes that there is a total order on all the responses (i.e., they can be ranked in a

monotonic order), which intuitively is captured by the BT assumption to a large extent. Meanwhile

when there is no total order, the formulation Eqn (1) would not be perfect, and one might need to

resort to alternative solution concepts such as Nash equilibrium (Munos et al., 2024; Swamy et al.,

2024).

In general, one should train a pairwise preference model Ë†â„“(ğ‘¦1, ğ‘¦2) = ğ‘Ÿğœ™(ğ‘¦1, ğ‘¦2) rather than pointwise

reward models, for which there could be characterizations on the properties of the learned model that

we discuss below. For pointwise models the analytic forms are only available in a few special cases

drawn from prior work. We discuss two notable examples: (1) the logistic loss, under the assumption

that the ground truth preference satisfies a BT model ğ‘(ğ‘¦1 â‰»ğ‘¦2) = ğœ(ğ‘Ÿâˆ—(ğ‘¦1) âˆ’ğ‘Ÿâˆ—(ğ‘¦2)), then the optimal

reward obtained by minimizing Eqn (3) is a constant shift from ğ‘Ÿâˆ—(Rafailov et al., 2023); (2) For the

squared loss, where the optimal reward is a constant away from ğ‘(ğ‘¦â‰»ğœ‡) = ğ”¼ğ‘¦â€²âˆ¼ğœ‡[ğ‘(ğ‘¦â‰»ğ‘¦â€²)] without

further assumptions on the ground truth preference. For interested readers, note that the discussion

here also provides an alternative way to derive the IPO algorithm distinct from the original derivation

in Azar et al. (2024).

6

## Page 7

Generalized Preference Optimization: A Unified Approach to Offline Alignment

0.00

0.25

0.50

0.75

1.00

(yi)

logistic

action

y1

y2

y3

square

hinge

exponential

truncated quadratic

beta = 1.0

savage

0.00

0.25

0.50

0.75

1.00

(yi)

beta = 2.0

0

2000

4000

6000

8000

Step

0.00

0.25

0.50

0.75

1.00

(yi)

0

2000

4000

6000

8000

Step

0

2000

4000

6000

8000

Step

0

2000

4000

6000

8000

Step

0

2000

4000

6000

8000

Step

0

2000

4000

6000

8000

Step

beta = 10.0

Figure 3 | Bandit example (Azar et al., 2024) to illustrate the regularization effect of different GPO variants.

Convex loss functions with a fast decaying tail or upwards tail (hinge, truncated quadratic and squared loss) will

penalize response-level deviations from ğœ‹ğœƒto ğœ‹ref, effectively enforcing a stronger regularization. Other convex

losses we exhibit here generally have a slower decaying tail, and will more likely converge to deterministic

policies in pathological cases (e.g., deterministic preference).

A case study of logistic loss vs. hinge loss.

Considering the special case when the preferred

and non-preferred samples are separable, the hinge loss will find the optimal separating hyperplane

that maximizes the margin between the two sets of samples. Drawing inspiration from the classic

comparison between logistic regression and support vector machine (Hastie et al., 2009), we note

that the logistic loss will find a similar decision boundary (i.e., sign of the prediction), but it will

try to increase the magnitude of the prediction Ë†â„“(ğ‘¦ğ‘¤, ğ‘¦ğ‘™) to infinity. Such behavior is alluded to in

the IPO work (Azar et al., 2024) as a failure case of DPO. In general, convex loss functions with a

fast-decaying tail (e.g., hinge loss for SLiC) or upwards tail (e.g., squared loss for IPO) will alleviate

such issues. In Section 4, we will illustrate such insights in combination with policy optimization.

General requirement on the convex function ğ‘“.

Not all convex functions ğ‘“can lead to valid loss

functions for binary classification. For our study, we further assume ğ‘“â€²(0) < 0, i.e., ğ‘“locally decreases

at ğœŒğœƒ= 0. This means that the minimizer of ğ‘“is obtained at some ğœŒğœƒ> 0, and intuitively would push

the reward difference ğ‘Ÿğœ™(ğ‘¦ğ‘¤) âˆ’ğ‘Ÿğœ™(ğ‘¦ğ‘™) in the right direction. Intriguingly, this condition is related to

Bayes consistency (Bartlett et al., 2006; Rosasco et al., 2004), i.e., under which condition can the

prediction function Ë†â„“(ğ‘¦1, ğ‘¦2) recover the same sign as the preference probability sign (2ğ‘(ğ‘¦1 â‰»ğ‘¦2) âˆ’1).

We provide discussions for interested readers in Appendix C.

4. Understanding regularization in offline preference optimization

In this section, we seek to gain a better understanding of the regularization implicitly enforced by the

offline preference optimization algorithms.

Though in general it is challenging to characterize the full learning dynamics of the offline algorithms,

we provide analysis from a few angles, which might shed light on how the regularization works.

Recall that in the RLHF formulation (Eqn 1), the KL regularization is a key element; we will see its

connections to the offline regularization.

4.1. How do offline losses enforce regularization

As hinted at before, henceforth will we consider the class of convex loss functions that are locally

decreasing at ğœŒğœƒ= 0, i.e., ğ‘“â€²(0) < 0. All the examples in Table 1 satisfy this property.

To shed light on how such loss functions entail preference optimization while enforcing regularizers,

7

## Page 8

Generalized Preference Optimization: A Unified Approach to Offline Alignment

we consider the Taylor expansion around ğœŒğœƒ= 0, which is a valid approximation when ğœŒğœƒis small,

i.e., ğœ‹ğœƒdoes not deviate much from ğœ‹ref.

ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ ğ‘“(ğ›½ğœŒğœƒ)]

|                   {z                   }

offline loss

â‰ˆğ‘“(0) + ğ‘“â€²(0)ğ›½Â· ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ğœŒğœƒ]

|                        {z                        }

preference optimization

+ ğ‘“â€²â€²(0)ğ›½2

2

Â· ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡



ğœŒ2

ğœƒ



|                           {z                           }

offline regularization

,

The expansion implies that when the approximation is valid, the offline algorithms all resemble

the case where ğ‘“is the squared loss (i.e., the IPO loss (Azar et al., 2024)). We provide more

discussion in Appendix B. Minimizing the Taylor-expanded objective achieves two purposes: preference

optimization and regularization towards the reference policy. Indeed, minimizing the first-order term

ğ‘“â€²(0)ğ›½Â· ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ğœŒğœƒ]

encourages ğœ‹ğœƒto place more weight on the preferred response ğ‘¦ğ‘¤over ğ‘¦ğ‘™, hence maximizing pairwise

human preference.

To see the effect of the regularization, when ğ‘“â€²â€²(0) > 0 observe that the second-order term

ğ‘“â€²â€²(0)ğ›½2 Â· ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡

1

2 ğœŒ2

ğœƒ



(6)

is minimized at ğœŒğœƒ= 0, in which case ğœ‹ğœƒ(ğ‘¦) = ğœ‹ref(ğ‘¦) for all ğ‘¦in the support of ğœ‡. In general, this

loss will encourage ğœ‹ğœƒto stay close to ğœ‹ref. We call the above ğœ‡-weighted squared loss. Importantly,

the global minimizer of the KL divergence between ğœ‹ğœƒand ğœ‹ref is also a minimizer of the ğœ‡-weighted

squared loss (i.e., both minimized when ğœ‹ğœƒ= ğœ‹ref).

When the approximation is valid, the GPO problem with a regularizer ğ›½is corresponds to the IPO

problem with regularizer | ğ‘“â€²â€²(0)/ ğ‘“â€²(0)| Â· ğ›½, and this quantity determines the relative strength of the

regularization. The coefficient | ğ‘“â€²â€²(0)/ ğ‘“â€²(0)| interestingly relates to how convex loss functions are

theoretically built-in to be regularized for better generalization (Masnadi-Shirazi and Vasconcelos,

2015). This may inform the design of offline preference optimization algorithms with another

theoretical perspective.

Intuition about the full gradient update.

The Taylor expansion is only valid near ğœŒğœƒ= 0 and except

for the special case of squared loss (IPO), drops higher order terms. For example, the expansion does

not work natively for SLiC, which employs a non-smooth convex function. Though understanding the

full learning dynamics is challenging, we can provide some intuitions about how the full gradient

update enforces ğœ‹ğœƒto stay close to ğœ‹ref: consider the gradient update for when ğ›½= 1,

ğœƒâ†ğœƒâˆ’ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ ğ‘“â€²(ğœŒğœƒ)âˆ‡ğœƒğœŒğœƒ] .

(7)

Starting from 0, suppose ğœŒğœƒtakes a very high value. This means potentially ğœ‹ğœƒplaces many more

weights on certain responses than ğœ‹ref, which is what the KL divergence regularization seeks to

prevent. For the offline update, since ğ‘“is convex, a few cases are possible: case I: ğ‘“â€²(ğœŒğœƒ) < 0 (for

logistic, exponential and Savage loss), ğœŒğœƒwill continue to increase but with a vanishing gradient;

hence the regularization is still in place. Meanwhile for case II: ğ‘“â€²(ğœŒğœƒ) â‰¤0 (for hinge, smoothed

quadratic and squared loss), ğœŒğœƒwill stop updating or be pushed downwards. As a result, in case II

the gradient update explicitly does not allow ğœ‹ğœƒ(ğ‘¦) to deviate from ğœ‹ref(ğ‘¦) for individual responses ğ‘¦,

effectively enforcing a stronger regularization with a fixed value of ğ›½.

In Figure ??, we illustrate the effect of strong regularization using the 3-action bandit example

presented in (Azar et al., 2024), where a simple offline dataset with three pairs of examples are

8

## Page 9

Generalized Preference Optimization: A Unified Approach to Offline Alignment

1.00

0.75

0.50

0.25

0.00

0.25

0.50

0.75

1.00

shift of

from

ref

4

2

0

2

4

6

8

log loss

(

,

ref)

y

[

1

2

2]

Figure 4 | An example of ğœ‡-weighted squared loss and KL divergence for mixture of Gaussians. The squared

loss has local minimizers different from the KL divergence. This means locally descending on the squared loss

may not lead to decreases in the KL divergence, and may not find the global minimizer of the KL divergence.

See Appendix A for the pdf of ğœ‹ref and ğœ‡.

used for training softmax parameterized policies: (ğ‘¦1, ğ‘¦2), (ğ‘¦2, ğ‘¦3), (ğ‘¦1, ğ‘¦3). Examples are uniformly

sampled from the distribution. Since ğ‘¦1 is the strongest response, we expect the algorithms to assign

high weights to ğœ‹ğœƒ(ğ‘¦1), causing deviation from ğœ‹ref which is uniform. The example is meant to

illustrate the undesirable behavior of DPO, which tends to push up the probability of ğ‘¦1, despite the

intended regularization. See Appendix A for more details on the setup.

We generalize their observations by noting that for any given values of ğ›½, case I losses will keep

pushing up the probability of a winning action ğ‘¦1, whereas case II losses enforce the constraint much

more conservatively, preventing deterministic policies. In practice where preferences over responses

are almost never deterministic, we will see that case I losses are also reasonably well behaved.

Choosing the right value for ğ›½.

if we understand the tail behavior of the convex function as

determining the natural regularization strength of the offline algorithm, the hyper-parameter ğ›½needs

to chosen accordingly, if one desires a fixed level of regularization. For example, the logistic loss (i.e.,

DPO) requires a higher value of ğ›½to enforce the same level of regularization as the squared loss (i.e.,

IPO) and the hinge loss (i.e., SLiC), as also exemplified in Figure ??.

4.2. Offline regularization vs. KL regularization

Henceforth we will resort back to the offline regularization: ğœ‡-weighted squared loss, and understand

its difference against the KL divergence regularization. We start with the gradient of the ğœ‡-weighted

squared loss

ğ”¼ğ‘¦âˆ¼ğœ‡



âˆ‡ğœƒ

1

2 ğœŒ2

ğœƒ



which seeks to decrease the squared error that measures the discrepancy between ğœ‹ğœƒand ğœ‹ref, at

samples generated by ğœ‡. For the KL divergence, we can show that its gradient is equivalent to the

9

## Page 10

Generalized Preference Optimization: A Unified Approach to Offline Alignment

ğœ‡-weighted squared loss with ğœ‡= ğœ‹ğœƒ

âˆ‡ğœƒğ•‚ğ•ƒ(ğœ‹ğœƒ, ğœ‹ref) = ğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ



âˆ‡ğœƒ

1

2 ğœŒ2

ğœƒ



.

(8)

In other words, we can understand the gradient to the KL divergence as minimizing the discrepancy

with on-policy samples under ğœ‹ğœƒ, rather than offline samples from ğœ‡. We detail the derivation in

Appendix B; note a highly similar result was also derived in (Richter et al., 2020).

In summary, both losses enforce the squared penalty on samples from ğœ‡vs. online samples from ğœ‹ğœƒ.

We can envision cases when the ğœ‡-weighted squared loss is being minimized, the KL divergence might

not decrease as desired.

A mixture of Gaussians counterexample.

To show the fact that, during minimization of the

squared loss, we may not necessarily observe global minimization of the KL divergence, we provide a

low-dimensional toy counterexample using mixture of Gaussians. We set up an example where both

ğœ‹ref and ğœ‡are mixtures of three Gaussians. The optimized policy ğœ‹ğœƒis just a constant shift away from

ğœ‹ref with the shift being parameterized by a trainable parameter ğ‘. When ğ‘= 0, we have ğœ‹ref = ğœ‹ğœƒ

and both the squared loss and KL divergence are minimized to 0.

In Figure 4, we show the KL divergence and the ğœ‡-weighted squared loss, both in log scales, as a

function of ğ‘âˆˆ[âˆ’1, 1]. The squared loss has a few minima, with some of them being remote from

ğ‘= 0. This means gradient descent on the squared loss may not lead to smaller KL in general, though

they are both globally minimized at ğœ‹ğœƒ= ğœ‹ref for ğ‘= 0. See Appendix A for the plot of the pdfs of ğœ‡

and ğœ‹.

This example is meant to illustrate that the arguments used in prior work on offline preference

optimization (Rafailov et al., 2023), which heavily rely on the global minimization of objectives,

may not always be true in practice: locally minimizing the ğœ‡-weighted squared loss might not lead

to decrease in the KL divergence. However, the silver lining is that near ğœ‹ğœƒ= ğœ‹ref, the two losses

are highly correlated; we will validate the observations on such a low-dimensional example with a

language modeling study.

4.3. Analyzing a language modeling example

In the case of language modeling, where ğœ‹ğœƒ, ğœ‹ref, ğœ‡are sequential categorical distributions, we measure

the correlation between the KL divergence ğ•‚ğ•ƒ(ğœ‹ğœƒ, ğœ‹ref) and the ğœ‡-weighted squared loss ğ”¼ğ‘¦âˆ¼ğœ‡

 1

2 ğœŒ2

ğœƒ



during offline training. We consider the summarization task similar to (Roit et al., 2023), where

the offline dataset is an open source summarization dataset collected with human feedback labels

(Stiennon et al., 2020). We give more details in Appendix A.

For each experiment, we choose a fixed value of regularization ğ›½. Then, we initialize ğœ‹ğœƒfrom ğœ‹ref

and minimize the offline preference losses over the dataset. As the training progresses, we record

sample-based estimates of the KL divergence and ğœ‡-weighted squared loss over time, and trace them

out in Figure 5 left plot for when ğ‘“is a squared function. We show both loss functions in the log scale.

Importantly, we have dropped from the plot the initial data point for which ğœ‹ğœƒ= ğœ‹ref and both losses

are zero, otherwise the whole plot will look unbalanced (since log 0 â‰ˆâˆ’inf). See the full plot in

Appendix A. We make a few comments regarding the current plot.

Correlation between the two losses.

There appears to be two phases in Figure 5 left plot. When ğ›½is

large, and when the ğœ‡-weighted squared loss is maintained at a lower level, we see a better correlation

between the two losses. Meanwhile, when ğ›½is small and the ğœ‡-weighted squared loss grows quickly

10

## Page 11

Generalized Preference Optimization: A Unified Approach to Offline Alignment

0.5

0.0

0.5

1.0

1.5

2.0

2.5

log

(

,

ref)

3

2

1

0

1

2

3

4

log Ey

[

1

2

2]

= 0.001

= 0.01

= 0.1

= 0.5

= 1.0

= 5.0

= 10.0

= 100.0

1.2

1.4

1.6

1.8

2.0

2.2

2.4

2.6

log

(

,

ref)

1.0

0.5

0.0

0.5

1.0

1.5

2.0

Logistic

Square

Hinge

Exponential

Truncated quadratic

Savage

Figure 5 | Tracing out KL divergence vs. ğœ‡-weighted squared loss during offline preference optimization. (Left)

With ğ‘“being the squared function, we show the trajectories for a range of ğ›½s. Importantly, the initial data point

for which ğœ‹ğœƒ= ğœ‹ref is dropped for better visualization, see Appendix A for the complete plot. Note that as ğ›½

increases, the algorithm maintains a better constraint on the ğœ‡-weighted squared loss, which also induces a

constraint on the KL divergence. (Right) We pool over different ğ›½s and show trajectories for different GPO

variants. See Appendix A for individual plots for each variant. Overall, all algorithmic variants enjoy similar

constraint properties, with most variants being slightly more stable than the logistic variant.

during optimization, its correlation with KL divergence becomes more elusive (see purple and blue

data points on the left plot). Such observations echo the mixture of Gaussian examples, where in the

vicinity of ğœ‹ğœƒ= ğœ‹ref, the two losses have similar trends; the misalignment happens when we deviate

too much from the origin.

Though the correlation between the two losses seem to break when ğœ‹ğœƒis too far away from ğœ‹ref, the

silver lining is that for offline algorithms, the optimization always starts with the origin ğœ‹ğœƒ= ğœ‹ref, and

one may expect a better control over the KL divergence through the ğœ‡-weighted squared loss.

More variations in KL compared to ğœ‡-weighted loss.

For Figure 5 left plot, in the regime where

the KL divergence and ğœ‡-weighted squared loss are better correlated (areas inside the grey bounding

box), we see an order of magnitude more drastic variations in the KL divergence (10âˆ’0.5 â†’101.5)

than the ğœ‡-weighted squared loss (10âˆ’1.5 â†’100.5).

This hints at the challenge of maintaining the KL divergence constraint by controlling the ğœ‡-weighted

squared loss. Indeed, since the offline preference optimization algorithms directly optimize for the

ğœ‡-weighted squared loss in the vicinity of the origin ğœ‹ğœƒ= ğœ‹ref, even small changes in the ğœ‡-weighted

squared loss can induce much bigger changes in the KL divergence. This might become a source of

instability during optimization. However, the degree to which such instability can be mitigated by

other hyper-parameter choices such as learning rate, might vary case-by-case.

Comparison across different GPO variants.

In Figure 5 right plot we compare the constraint

contours across different GPO variants listed in Table 1. For each variant we sweep the ğ›½s but for

visualization we pool across results from all ğ›½s, see Appendix A for individual plots.

11

## Page 12

Generalized Preference Optimization: A Unified Approach to Offline Alignment

0.5

0.0

0.5

1.0

1.5

2.0

2.5

3.0

log

(

,

sft)

0.00

0.02

0.04

0.06

0.08

0.10

0.12

0.14

Win rate against golden policy

Logistic

Square

Hinge

Exponential

Truncated square

Savage

0.5

1.0

1.5

2.0

2.5

log

(

,

sft)

0.00

0.02

0.04

0.06

0.08

0.10

0.12

= 0.01

= 0.05

= 0.1

= 0.5

= 1.0

= 5

= 10

= 50

= 100

Figure 6 | Left: Tracing KL divergence vs. golden win rate performance for different GPO variants.

Each data point corresponds to a policy obtained during training with a particular value of ğ›½and

convex function loss. For each loss variant, we pool data points across ğ›½s and different stages of

training. Overall, the trade-off curves of GPO variants look similar. Right: Tracing the trade-off for

the logistic loss (DPO), grouped according to the regularization coefficient ğ›½. As ğ›½increases, the

regularization effect is larger and during training, and the policies tend to have smaller KL divergence

against ğœ‹sft.

Overall, different variants follow a similar pattern, with most variants being slightly more robust

compared to the logistic loss, which seems to induce slightly bigger variations in the KL divergence

compared to other alternatives.

5. Empirical study of GPO variants

We now carry out a set of experimental comparison between different GPO algorithms, and to study

their empirical behavior and validate theoretical insights.

5.1. Trade-offs between KL divergence and performance

As the offline alignment optimization progresses, the policy ğœ‹ğœƒstarts to drift away from the initial

anchor policy ğœ‹sft. When measured in terms of the ground truth performance, there is a trade-off

between model performance and KL divergence from the initialization. We adopt a synthetic setting

similar to (Gao et al., 2023) to study this trade-off.

Concretely, we take the summarization task introduced above and train a XXL model (11 billion

parameters) as the golden preference model, using similar training setting as Munos et al. (2024).

This preference model will be used as the golden judgement. Since the preference model carries out

side by side comparison, we also train a golden policy as the fixed baseline to compare against. We

provide more technical details in Appendix A. For each fixed convex loss function, we sweep over

values of the regularization coefficient ğ›½. For each ğ›½, we train the model for 2 Â· 104 steps with a

constant learning rate (10âˆ’5 and 3 Â· 10âˆ’5). We evaluate checkpoints every 2ğ‘˜steps for a total of 20ğ‘˜

training steps.

In Figure 6 (left), we trace the performance of trained checkpoints over time, plotting their golden

12

## Page 13

Generalized Preference Optimization: A Unified Approach to Offline Alignment

2.0

1.5

1.0

0.5

0.0

0.5

1.0

1.5

2.0

log10

0.02

0.04

0.06

0.08

0.10

0.12

0.14

Peak win rate

Logistic

Square

Hinge

Exponential

Truncated square

Savage

Best  for square

Best  for logistic

2.0

1.5

1.0

0.5

0.0

0.5

1.0

1.5

2.0

log10

0.0

0.5

1.0

1.5

2.0

2.5

Median log

(

,

sft)

Best performing KL divergence

Figure 7 | Left: 90%-th percentile performance during training for different values of ğ›½s. We use the

90%-th percentile as an estimate of the best possible performance under a fixed ğ›½. Different GPO

variants seem to peak at different values of ğ›½: noticeably, squared loss and truncated squared loss

peak at about ğ›½= 1 while others mostly peak at slightly larger values ğ›½âˆ¼10. Right: Median values

of KL divergence during training, as a function of ğ›½for different GPO variants. When ğ›½is small,

different variants have little distinction; when ğ›½is large (strong regularization) and fixed, squared

and truncated squared loss tend to incur smaller KL divergence compared to other variants.

evaluation performance against the golden policy. Each dot corresponds to a checkpoint evaluation,

for a particular value of ğ›½, learning rate and convex function loss. We group the results by the convex

function loss. A few observations are in order: (1) We observe the over-optimization effect compatible

with Goodhartâ€™s law Gao et al. (2023), wherein as the KL divergence increases, the golden performance

evaluation first increases and then decreases as a result of over-optimization. The key difference is

that (Gao et al., 2023) is for online RLHF, while our case is offline optimization; (2) For different loss

functions, the overall trade-off curves look similar. Concretely, the peak performance is similar and

is obtained at a similar level of KL divergence. This suggests that for any choice of the convex loss

function, a choice of ğ›½and training step can lead to a specified level of performance.

In Figure 6 (right), we break down the trade-off curve with respect to the regularization coefficient ğ›½.

We show the case for the logistic loss, though other losses have a similar breakdown (see Appendix A

for full results). For each ğ›½(with a unique color), different data points correspond to different

stage of training for the same experiment and hence tracing out a trend of KL divergence vs. win

rate. We make a few observations: (1) Data points seem to piece together seamlessly at the soft

boundaries between ğ›½s, this means given a fixed value of ğ›½, one can probably obtain a specified level

of KL divergence and win rate performance, by training the policy for a certain number of steps.

However, different ğ›½s are not equal: in the case of logistic loss, ğ›½âˆ¼1 seems to obtain the best overall

performance across training, while ğ›½= 0.01 can easily train the policy to have large KL divergence,

resulting in degraded performance; meanwhile, ğ›½= 100 puts a larger constrain the policy near ğœ‹sft,

making it difficult to obtain the best performance across training.

Impact of ğ›½.

We now closely investigate the impact that ğ›½has on the performance and KL regu-

larization dynamics of various GPO variants. Figure 7 (left) shows the peak performance of various

13

## Page 14

Generalized Preference Optimization: A Unified Approach to Offline Alignment

algorithms as a function of ğ›½. As seen from the plot, the peak performance of squared and truncated

squared loss is obtained at generally lower ğ›½âˆ¼1, whereas the peak performance for other variants

are obtained at higher ğ›½âˆ¼10. There is some variations of the peak win rate (e.g., exponential seems

to be slightly better than others) but this might not be statistically significant.

While the observation suggests the fact that different algorithms require different values of ğ›½s to

perform the best, it can be explained by the fact that different loss functions induce distinct strengths

of regularization as a function of ğ›½, as predicted by theory. In Figure 7 (right) we show the median KL

divergence during training as a function of ğ›½, for different convex loss functions. When ğ›½is small and

regularization is weak, there is little distinction between different variants. This is compatible with

the results in Figure 5: the offline algorithm enforces regularization through the weighted squared

loss, and its correlation with KL divergence is weak when the regularization is small. At large values

of ğ›½s, the correlation between offline regularization and KL divergence is much stronger. And indeed,

we see squared and truncated squared loss enforce stronger regularization than other variants, with

logistic, exponential and Savage being in the same league and hinge loss in the middle.

5.2. Model-based side by side evaluation

The synthetic setting has provided many insights into the trade-offs between regularization and

policy performance, and how they are modulated by choices of ğ›½and convex loss functions. We now

carry out a final set of experiments on the summarization task, using settings described in prior work

(Calandriello et al., 2024; Munos et al., 2024).

We consider the side-by-side comparison metric used by Munos et al. (2024), where we compare

the checkpoint performance against a fixed opponent ğœ‹ref. The comparison is made by a prompted

PaLM-2 model (Anil et al., 2023) over an evaluation set of 2000 summary samples. The prompted

model judges which response is of higher quality. See Appendix A for evaluation details.

Examining the performance across ğ›½s, we see that when ğ›½is small, the optimization tends to be

more effective, achieving the best performance at about ğ›½âˆˆ[0.1, 1] across the board, with similar

peak performance. The performance experiences a bigger drop when ğ›½becomes large. When making

pairwise comparison across different GPO variants, we see that their performance is generally on par

with one another; choosing the right ğ›½appears more critical. Due to space limits, we present these

comparisons in Appendix A.

6. Discussions and conclusion

We have presented GPO, a generalized approach to deriving offline preference optimization losses

for LLM alignment. GPO presents a continuous spectrum of loss functions, encompassing DPO, IPO

and SLiC as special instances. By deriving GPO through the rich literature on binary classification,

we have presented a more unified way to reason about the strength of regularization and what the

optimized policy seeks to capture.

We have shown the connections between the offline regularization and the KL regularization, which

the RLHF formulation seeks to enforce. The two types of regularization are different in general.

However, optimizing from the origin, we see empirical evidence that the two losses are correlated,

alluding to the fact that enforcing KL divergence through offline optimization is possible though

maybe more challenging.

We have also showed the regularization vs. performance trade-off between different GPO variants.

Overall, the regularization vs. performance trade-off is similar for different algorithms. As predicted

by theory, different convex loss variants induce inherently distinct strengths for regularization, which

impacts the optimal value of ğ›½for each algorithm (i.e., squared loss needs a smaller ğ›½than logistic

14

## Page 15

Generalized Preference Optimization: A Unified Approach to Offline Alignment

loss).

Our results have a number of limitations and provide avenues for future work. Our framework is

based on the reward maximization formulation of RLHF, and hence still encounters theoretical issues

when the ground truth preference structure is complex. A future direction would be to connect GPO

with alternative solution concepts for alignment such as Nash equilibrium (Munos et al., 2024). Our

framework also only deals with offline losses with a contrastive form, and does not handle supervised

learning based losses (Zhao et al., 2023).

Acknowledgements.

We thank Ivo Danihelka for providing very valuable feedback to an earlier

draft of the paper. We are thankful to the Google DeepMind teams that build the infrastructure which

facilitates the research in this work.

References

Josh Achiam, Steven Adler, Sandhini Agarwal, Lama Ahmad, Ilge Akkaya, Florencia Leoni Aleman,

Diogo Almeida, Janko Altenschmidt, Sam Altman, Shyamal Anadkat, et al. GPT-4 technical report.

arXiv preprint arXiv:2303.08774, 2023.

Rohan Anil, Andrew M. Dai, Orhan Firat, Melvin Johnson, Dmitry Lepikhin, Alexandre Passos, Siamak

Shakeri, Emanuel Taropa, Paige Bailey, Zhifeng Chen, et al. PaLM 2 technical report. arXiv preprint

arXiv:2305.10403, 2023.

Mohammad Gheshlaghi Azar, Mark Rowland, Bilal Piot, Daniel Guo, Daniele Calandriello, Michal

Valko, and RÃ©mi Munos. A general theoretical paradigm to understand learning from human

preferences. In Proceedings of the International Conference on Artificial Intelligence and Statistics,

2024.

Peter L. Bartlett, Michael I. Jordan, and Jon D. McAuliffe. Convexity, classification, and risk bounds.

Journal of the American Statistical Association, 101(473):138â€“156, 2006.

Bernhard E. Boser, Isabelle M. Guyon, and Vladimir N. Vapnik. A training algorithm for optimal

margin classifiers. In Proceedings of the Workshop on Computational Learning Theory, 1992.

Ralph Allan Bradley and Milton E. Terry. Rank analysis of incomplete block designs: I. the method of

paired comparisons. Biometrika, 39(3/4):324â€“345, 1952.

Daniele Calandriello, Daniel Guo, Remi Munos, Mark Rowland, Yunhao Tang, Bernardo Avila Pires,

Pierre Harvey Richemond, Charline Le Lan, Michal Valko, Tianqi Liu, Rishabh Joshi, Zeyu Zheng,

and Bilal Piot. Human alignment of large language models through online preference optimisation.

In Proceedings of the International Conference on Machine Learning, 2024.

Paul F. Christiano, Jan Leike, Tom Brown, Miljan Martic, Shane Legg, and Dario Amodei. Deep

reinforcement learning from human preferences. In Advances in Neural Information Processing

Systems, 2017.

Corinna Cortes and Vladimir Vapnik. Support-vector networks. Machine learning, 20:273â€“297, 1995.

Yoav Freund and Robert E. Schapire. A desicion-theoretic generalization of on-line learning and

an application to boosting. In Proceedings of the European conference on Computational Learning

Theory, 1995.

Leo Gao, John Schulman, and Jacob Hilton. Scaling laws for reward model overoptimization. In

Proceedings of the International Conference on Machine Learning, 2023.

15

## Page 16

Generalized Preference Optimization: A Unified Approach to Offline Alignment

Trevor Hastie, Robert Tibshirani, and Jerome H. Friedman. The elements of statistical learning: Data

mining, inference, and prediction. Springer, 2009.

Albert Q. Jiang, Alexandre Sablayrolles, Antoine Roux, Arthur Mensch, Blanche Savary, Chris Bamford,

Devendra Singh Chaplot, Diego de las Casas, Emma Bou Hanna, Florian Bressand, et al. Mixtral of

experts. arXiv preprint arXiv:2401.04088, 2024.

Hamed Masnadi-Shirazi and Nuno Vasconcelos. On the design of loss functions for classification:

Yheory, robustness to outliers, and SavageBoost. In Advances in Neural Information Processing

Systems, 2008.

Hamed Masnadi-Shirazi and Nuno Vasconcelos. A view of margin losses as regularizers of probability

estimates. Journal of Machine Learning Research, 16(1):2751â€“2795, 2015.

RÃ©mi Munos, Michal Valko, Daniele Calandriello, Mohammad Gheshlaghi Azar, Mark Rowland, Daniel

Guo, Yunhao Tang, Matthieu Geist, Thomas Mesnard, Andrea Michi, Marco Selvi, Sertan Girgin,

Nikola Momchev, Olivier Bachem, Daniel J. Mankowitz, Doina Precup, and Bilal Piot. Nash learning

from human feedback. In Proceedings of the International Conference on Machine Learning, 2024.

Long Ouyang, Jeffrey Wu, Xu Jiang, Diogo Almeida, Carroll Wainwright, Pamela Mishkin, Chong

Zhang, Sandhini Agarwal, Katarina Slama, Alex Ray, et al. Training language models to follow

instructions with human feedback. In Advances in Neural Information Processing Systems, 2022.

Rafael Rafailov, Archit Sharma, Eric Mitchell, Stefano Ermon, Christopher D. Manning, and Chelsea

Finn. Direct preference optimization: Your language model is secretly a reward model. In Advances

in Neural Information Processing Systems, 2023.

Colin Raffel, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael Matena, Yanqi

Zhou, Wei Li, and Peter J. Liu. Exploring the limits of transfer learning with a unified text-to-text

transformer. Journal of Machine Learning Research, 21(140):1â€“67, 2020.

Lorenz Richter, Ayman Boustati, Nikolas NÃ¼sken, Francisco Ruiz, and Omer Deniz Akyildiz. VarGrad:

A low-variance gradient estimator for variational inference. In Advances in Neural Information

Processing Systems, 2020.

Adam Roberts, Hyung Won Chung, Gaurav Mishra, Anselm Levskaya, James Bradbury, Daniel Andor,

Sharan Narang, Brian Lester, Colin Gaffney, Afroz Mohiuddin, et al. Scaling up models and data

with t5x and seqio. Journal of Machine Learning Research, 24(377):1â€“8, 2023.

Paul Roit, Johan Ferret, Lior Shani, Roee Aharoni, Geoffrey Cideron, Robert Dadashi, Matthieu Geist,

Sertan Girgin, LÃ©onard Hussenot, Orgad Keller, et al. Factually consistent summarization via

reinforcement learning with textual entailment feedback. In Proceedings of the Annual Meeting of

the Association for Computational Linguistics, 2023.

Lorenzo Rosasco, Ernesto De Vito, Andrea Caponnetto, Michele Piana, and Alessandro Verri. Are loss

functions all the same? Neural computation, 16(5):1063â€“1076, 2004.

Noam Shazeer and Mitchell Stern. Adafactor: Adaptive learning rates with sublinear memory cost.

In Proceedings of the International Conference on Machine Learning, 2018.

Nisan Stiennon, Long Ouyang, Jeffrey Wu, Daniel Ziegler, Ryan Lowe, Chelsea Voss, Alec Radford,

Dario Amodei, and Paul F. Christiano. Learning to summarize with human feedback. In Advances

in Neural Information Processing Systems, 2020.

Gokul Swamy, Christoph Dann, Rahul Kidambi, Zhiwei Steven Wu, and Alekh Agarwal. A minimaxi-

16

## Page 17

Generalized Preference Optimization: A Unified Approach to Offline Alignment

malist approach to reinforcement learning from human feedback. arXiv preprint arXiv:2401.04056,

2024.

Gemini Team, Rohan Anil, Sebastian Borgeaud, Yonghui Wu, Jean-Baptiste Alayrac, Jiahui Yu, Radu

Soricut, Johan Schalkwyk, Andrew M Dai, Anja Hauth, et al. Gemini: A family of highly capable

multimodal models. arXiv preprint arXiv:2312.11805, 2023.

Yao Zhao, Rishabh Joshi, Tianqi Liu, Misha Khalman, Mohammad Saleh, and Peter J. Liu. SLiC-HF:

Sequence likelihood calibration with human feedback. arXiv preprint arXiv:2305.10425, 2023.

17

## Page 18

Generalized Preference Optimization: A Unified Approach to Offline Alignment

A. Experiment details and additional results

We provide further details and additional results on experiments across the paper.

A.1. Bandit experiment

To illustrate the regularization properties of various GPO variants, we have employed the bandit

experiment introduced in (Azar et al., 2024). We consider a 3-action bandit problem where the

dataset consists of three possibilities

(ğ‘¦1, ğ‘¦2), (ğ‘¦2, ğ‘¦3), (ğ‘¦1, ğ‘¦3).

Sampling from the offline dataset consists in uniformly sampling from the pairs. We then train softmax

parameterized policies with exactly the same setup as (Azar et al., 2024). Note that with logistic,

exponential and Savage loss, because the tail does not vanish fast enough, the policy converges to

the greedy action ğ‘¦1 even with regularization at ğ›½= 1. While for the other three losses, thanks to

stronger regularization, ğœ‹ğœƒ(ğ‘¦1) maintains closer distance to ğœ‹ref(ğ‘¦1).

A.2. A mixture of Gaussian counterexample

We find the counterexample by parameterizing all related distributions as mixtures of Gaussians with

3 modes. It is not difficult to construct numerical counterexamples as shown in the paper, with â‰¤5

simulations.

The offline distribution ğœ‡is parameterized as ğœ‡= 1

3N (ğ‘¢1, 0.052)+ 1

3N (ğ‘¢2, 0.052)+ 1

3N (ğ‘¢3, 0.052) where

ğ‘¢1, ğ‘¢2, ğ‘¢3 are i.i.d. uniform between âˆ’1 and 1. The reference policy is fixed as ğœ‹ref =

3

## 10N (âˆ’0.8, 0.12) +

4

## 10N (0, 0.12) +

3

10N (0.8, 0.12). The optimized policy ğœ‹ğœƒis a constant shift away from ğœ‹ref. The

particular choice of the parameters are fairly ad-hoc and other choices of hyper-parameters should

lead to clear counterexamples as well. Since for mixtures of Gaussians, both the KL divergence and

the ğœ‡-weighted squared loss do not yield analytic forms. Instead, we draw 2000 samples to estimate

both losses as unbiased estimates.

Figure 8 (left) shows the probability density function (pdf) for ğœ‹ref and ğœ‡, in the counterexample

that we presented.

A.3. Language modeling experiments

We consider the summarization task similar to (Roit et al., 2023), where the offline dataset is an

open source summarization dataset collected with human feedback labels (Stiennon et al., 2020).

The base model is T5X (Roberts et al., 2023), a family of LLMs based on encoder-decoder transformer

architecture. Throughout, we train large-sized models with 700ğ‘€parameters. During training,

we apply a constant learning rate of 10âˆ’5 with batch size ğ‘= 32. We use the Adafactor optimizer

(Shazeer and Stern, 2018) with a decay rate of 0.8. Each model is trained for 2 Ã— 105 steps in total.

The evaluation follows from (Munos et al., 2024) where they consider the side-by-side comparison

metric between two models. A default baseline model is the supervised fine-tuned baseline ğœ‹ref.

The comparison is made by a prompted PALM-2 model (Anil et al., 2023), where the model judges

which response is of higher quality. The evaluation set consists of 2000 examples, each containing a

paragraph to summarize. The prompted model is given the paragraph, as well as the two summaries

generated by the two compared models, to deliver a final verdict.

Tracing KL divergence and ğœ‡-weighted squared loss.

For each experiment (with a fixed convex

function ğ‘“and fixed ğ›½), we evaluate intermittently the ğœ‡-weighted squared loss on the learner and

the KL divergence on the evaluator. The evaluator is carried out every 2000 steps where we train for

18

## Page 19

Generalized Preference Optimization: A Unified Approach to Offline Alignment

1.00

0.75

0.50

0.25

0.00

0.25

0.50

0.75

1.00

x

0.0

0.5

1.0

1.5

2.0

2.5

density

ref

1.00

0.75

0.50

0.25

0.00

0.25

0.50

0.75

1.00

shift of

from

ref

4

2

0

2

4

6

8

log loss

(

,

ref)

y

[

1

2

2]

Figure 8 | Full results for the mixture of Gaussian counterexample. (Left) The probability density

function (pdf) for ğœ‡and ğœ‹ref, both are designed to be mixtures of Gaussian with 3 modes; (Right)

The same plot as Figure 4.

a total of 20000 steps. We also evaluate every 200 steps for the first 2000 steps since the initial stage

during training presents the most salient changes in the ğœ‡-weighted squared losses.

The tracing plot for individual GPO variant is shown in Figure 10 for better visualization.

A.4. Trade-off between performance and KL divergence

All experiments are carried out with T5X models (Raffel et al., 2020) with the T5X data and compute

framework (Roberts et al., 2023). To create a synthetic setup similar to Gao et al. (2023), we take

the summarization dataset and train a golden preference model with the XXL model (11 billion

parameters). Then we use the XXL model to relabel the offline dataset, and all offline experiments

going forward are carried out with this relabeled dataset.

Since the preference model requires side by side comparison, we also train a golden policy using

online IPO (Calandriello et al., 2024) using the golden preference model. This policy is denoted

golden because it makes use of the golden preference model during training, and should arguably

obtain the best possible performance over time. We use this policy as the reference policy during

evaluation.

All policies are trained with the Large T5X model (110 million parameters) using offline preference

optimization variants outlined in the paper.

Full results on the breakdown of KL divergence vs. win rate.

Figure 9 shows the win rate

performance and KL divergence trade-off curves across different algorithmic variants of GPO. For

each algorithmic variant, the data points are grouped by the regularization coefficient ğ›½. Overall,

different algorithmic variants exhibit trade-off pattern and their dependency on ğ›½is similar too.

It is worth noting that compatible with results reported in Figure 7, all algorithmic variants achieve

the peak performance at the same value of KL divergence but with a different value of ğ›½. This is the

result of the fact that different loss functions have different natural strength of regularization.

19

## Page 20

Generalized Preference Optimization: A Unified Approach to Offline Alignment

0.5

1.0

1.5

2.0

2.5

0.00

0.02

0.04

0.06

0.08

0.10

0.12

Win rate against golden policy

f = Logistic

= 0.01

= 0.05

= 0.1

= 0.5

= 1.0

= 5

= 10

= 50

= 100

0.5

0.0

0.5

1.0

1.5

2.0

2.5

3.0

0.00

0.02

0.04

0.06

0.08

0.10

0.12

f = Square

0.0

0.5

1.0

1.5

2.0

2.5

0.00

0.02

0.04

0.06

0.08

0.10

0.12

f = Hinge

0.0

0.5

1.0

1.5

2.0

2.5

log

(

,

sft)

0.00

0.02

0.04

0.06

0.08

0.10

0.12

0.14

Win rate against golden policy

f = Exponential

0.0

0.5

1.0

1.5

2.0

2.5

3.0

log

(

,

sft)

0.00

0.02

0.04

0.06

0.08

0.10

0.12

f = Truncated square

0.5

1.0

1.5

2.0

2.5

log

(

,

sft)

0.00

0.02

0.04

0.06

0.08

0.10

0.12

f = Savage

Figure 9 | Tracing the trade-off between performance and KL divergence for the various loss functions.

For each loss function, the data points are grouped according to the regularization coefficient ğ›½. We

see that different algorithmic variants exhibit similar patterns both in terms of the general trade-off

curves, as well as the dependency of the curves on ğ›½.

20

## Page 21

Generalized Preference Optimization: A Unified Approach to Offline Alignment

1.4

1.6

1.8

2.0

2.2

2.4

2.6

0.5

0.0

0.5

1.0

1.5

2.0

log Ey

[

1

2

2]

f = Logistic

1.4

1.6

1.8

2.0

2.2

2.4

0.5

0.0

0.5

1.0

1.5

2.0

f = Square

1.2

1.4

1.6

1.8

2.0

2.2

2.4

0.5

0.0

0.5

1.0

1.5

2.0

f = Hinge

1.2

1.4

1.6

1.8

2.0

2.2

log

(

,

ref)

1.0

0.5

0.0

0.5

1.0

1.5

2.0

log Ey

[

1

2

2]

f = Exponential

1.4

1.6

1.8

2.0

2.2

2.4

2.6

log

(

,

ref)

0.5

0.0

0.5

1.0

1.5

2.0

f = Truncated quadratic

1.2

1.4

1.6

1.8

2.0

2.2

2.4

log

(

,

ref)

1.0

0.5

0.0

0.5

1.0

1.5

2.0

f = Savage

Figure 10 | Tracing out KL divergence vs. ğœ‡-weighted squared loss during offline preference optimiza-

tion, for individual GPO variants. This plot separates the data from Figure 5 for better visualization.

Side by side evaluation.

We subsample 256 prompts from the training set and generate responses

from both the golden policy and the target policy to compare against. We then use the preference

model to judge the win rate between the two sets of responses, and average across the subsampled

prompt set.

A.5. Model-based side by side evaluation

We now discuss experimental results on the summarization task with model-based side by side

evaluation. While previous study on the KL divergence vs. win rate trade-off is carried out in a

synthetic setting, here we train models with the open sourced summarization dataset (Stiennon et al.,

2020) and prompt a PALM-2 model (Anil et al., 2023) for side by side evaluation. We adopt identical

evaluation setup as in (Munos et al., 2024) and (Calandriello et al., 2024).

Win rate results.

In Figure 11, we show the win rate of various algorithmic variants in a side-by-side

comparison against the supervised fine-tuned checkpoint ğœ‹ref. For two identical models, the win rate

should be 0.5. We observe that the best performance is usually obtained at ğ›½âˆˆ[0.1, 1], with similar

performance across different ğ‘“s. Interestingly, when ğ›½becomes too large, the win rate drops more

quickly across all methods.

In Figure 12, we show the side by side comparison across GPO variants. For each variant, we take

the checkpoint with ğ›½= 0.1 since this appears to be a value where all algorithms work reasonably,

according to the win rate against the supervised fine-tuned checkpoint. The win rate comparison

across GPO variants suggests that they perform mostly similar.

21

## Page 22

Generalized Preference Optimization: A Unified Approach to Offline Alignment

3.0

2.5

2.0

1.5

1.0

0.5

0.0

0.5

log10

0.5

0.6

0.7

0.8

0.9

Win rate against

ref

Logistic

Square

Hinge

Exponential

Truncated square

Savage

Figure 11 | Win rate of various GPO methods against the supervised fine-tuned baseline ğœ‹ref, as a

function of ğ›½. Almost all algorithmic variants obtain the best performance at ğ›½âˆˆ[0.1, 1], with similar

peak performance.

B. Proof and derivations of theoretical results

We provide more detailed proof to a few important theoretical results in the paper.

Theorem 1. (Equivalence of optimal solutions) Let ğœ‹âˆ—

ğœƒbe the global minimizer of the offline

preference optimization loss in Eqn (4). ğœ‹âˆ—

ğœƒis the same as the optimal regularized policy (according

to Eqn (1)) for a reward function that globally minimizes the loss Eqn (3).

Proof. The proof is straightforward. Indeed, note that if we seek to minimize Eqn (3) with ğ‘Ÿğœ™, we can

reparameterize the reward function as ğ‘Ÿğœ™(ğ‘¦) = ğ›½log ğœ‹ğœƒ(ğ‘¦)

ğœ‹ref(ğ‘¦) +ğ‘§with normalizing constant ğ‘§that depends

on ğœ‹ğœƒ. Then if ğ‘Ÿâˆ—

ğœ™is the global minimizer to Eqn (3), the corresponding ğœ‹ğœƒ(ğ‘¦) âˆğœ‹ref(ğ‘¦) exp(ğ›½âˆ’1ğ‘Ÿâˆ—

ğœ™(ğ‘¦))

must be the global minimizer to Eqn (4).

B.1. Derivation of the gradient of KL divergence and ğœ‡-weighted squared loss

By definition we have ğ•‚ğ•ƒ(ğœ‹ğœƒ, ğœ‹ref) = ğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ

h

log ğœ‹ğœƒ(ğ‘¦)

ğœ‹ref(ğ‘¦)

i

, its gradient contains two terms

âˆ‡ğœƒğ•‚ğ•ƒ(ğœ‹ğœƒ, ğœ‹ref) = ğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ



log ğœ‹ğœƒ(ğ‘¦)

ğœ‹ref(ğ‘¦) âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦)



+ ğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ[âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦)]

|                     {z                     }

=0

The second term vanishes because it is the expectation of a score function with respect to the

distribution itself. Meanwhile, for the ğœ‡-weighted squared loss, we rewrite the original definition as

1

2ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡



ğœŒ2

ğœƒ



= 1

2ğ”¼(ğ‘¦1,ğ‘¦2)âˆ¼ğœ‡

"

log ğœ‹ğœƒ(ğ‘¦1)

ğœ‹ref(ğ‘¦1) âˆ’log ğœ‹ğœƒ(ğ‘¦2)

ğœ‹ref(ğ‘¦2)

2#

,

22

## Page 23

Generalized Preference Optimization: A Unified Approach to Offline Alignment

Logistic

Square

Hinge

Exponential

Truncated quadratic

Savage

Logistic

Square

Hinge

Exponential

Truncated quadratic

Savage

50%

48%

50%

47%

50%

48%

51%

50%

53%

50%

53%

50%

49%

46%

50%

47%

50%

48%

52%

49%

52%

50%

51%

48%

49%

46%

49%

48%

50%

46%

51%

49%

51%

51%

53%

50%

Win rate of row vs. column

Figure 12 | Win rate of various GPO methods against one another. We take all checkpoints at ğ›½= 0.1

since this is a value where all variants have reasonable performance. We show the color coded win

rates in a matrix.

where the equality is based on the fact that the order of (ğ‘¦ğ‘¤, ğ‘¦ğ‘™) does not impact the expectation.

Now, taking the gradient of the above loss with ğœ‡= ğœ‹ğœƒ,

ğ”¼(ğ‘¦1,ğ‘¦2)âˆ¼ğœ‹ğœƒ



âˆ‡ğœƒ

1

2 ğœŒ2

ğœƒ



= ğ”¼(ğ‘¦1,ğ‘¦2)âˆ¼ğœ‡

1

2



log ğœ‹ğœƒ(ğ‘¦1)

ğœ‹ref(ğ‘¦1) âˆ’log ğœ‹ğœƒ(ğ‘¦2)

ğœ‹ref(ğ‘¦2)



(âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦1) âˆ’âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦2))



,

=(ğ‘)

1

2ğ”¼(ğ‘¦1,ğ‘¦2)âˆ¼ğœ‹ğœƒ



log ğœ‹ğœƒ(ğ‘¦1)

ğœ‹ref(ğ‘¦1) âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦1) + log ğœ‹ğœƒ(ğ‘¦2)

ğœ‹ref(ğ‘¦2) âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦2)



=(ğ‘) ğ”¼ğ‘¦âˆ¼ğœ‹ğœƒ



log ğœ‹ğœƒ(ğ‘¦)

ğœ‹ref(ğ‘¦) âˆ‡ğœƒlog ğœ‹ğœƒ(ğ‘¦)



.

Here, (a) follows from the fact the cross term vanishes because ğ‘¦1, ğ‘¦2 are independent; (b) follows

from the fact that ğ‘¦1, ğ‘¦2 are identically distributed. This proves the desired equality in Eqn (8).

Relation to results from (Richter et al., 2020).

A highly related result has been derived in (Richter

et al., 2020), relating the gradient of the KL divergence to the gradient of the variance of the log ratio.

We provide a simple derivation here. Note that when ğœ‡= ğœ‹ğœƒ, the ğœ‡-weighted squared loss indeed

evaluates to a variance

ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡

1

2 ğœŒ2

ğœƒ



## = ğ•



log ğœ‹ğœƒ(ğ‘¦)

ğœ‹ref(ğ‘¦)



.

To see this note that if ğ‘Œ, ğ‘Œâ€² are i.i.d. samples then 1

## 2ğ”¼



## (ğ‘Œâˆ’ğ‘Œâ€²)2

## = ğ•[ğ‘Œ].

â–¡

B.2. Discussion on Taylor expansions of the GPO losses

Assume that ğ‘“is smoothly differentiable and convex, and ğ‘“â€²(0) < 0, then the GPO problem with the

second order Taylor expansion recovers the squared loss with ğ›½â€² = ğ‘“â€²â€²(0) ğ›½

| ğ‘“â€²(0) | . Note that the squared loss

is effectively the IPO loss.

23

## Page 24

Generalized Preference Optimization: A Unified Approach to Offline Alignment

To see this, by the second order Taylor approximation to ğ‘“around ğœŒğœƒ= 0, we have

ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ ğ‘“(ğ›½ğœŒğœƒ)] â‰ˆğ‘“(0) + ğ‘“â€²(0)ğ›½Â· ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ğœŒğœƒ] + ğ‘“â€²â€²(0)ğ›½2

2

Â· ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡



ğœŒ2

ğœƒ



= ğ‘“(0) + ğ‘“â€²(0)2

2 ğ‘“â€²â€²(0)

 ğ‘“â€²â€²(0)

| ğ‘“â€²(0)| ğ›½ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡[ğœŒğœƒ] âˆ’1

2

âˆ’ğ‘“â€²(0)2

2 ğ‘“â€²â€²(0)

â‰¡(ğ‘) ğ”¼(ğ‘¦ğ‘¤,ğ‘¦ğ‘™)âˆ¼ğœ‡

" ğ‘“â€²â€²(0)ğ›½

| ğ‘“â€²(0)| ğœŒğœƒâˆ’1

2#

,

where for (a) we have rearranged terms and the equivalence is up to constants. Indeed, we see that

the Taylor-expanded GPO loss is equivalent to the IPO loss with ğ›½â€² as defined above.

C. Discussion on Bayes consistency for the learned reward model

Here we provide a brief background on Bayes consistency. Using the notation from Section 3, we

consider binary classification loss of the following form with a convex function ğ‘“

## ğ”¼

h

ğ‘“



Ë†â„“(ğ‘§) Â· â„“

i

where ğ‘™âˆˆ{âˆ’1, 1} is the ground-truth label and Ë†â„“(ğ‘§) is the prediction. The Bayes optimal classifier,

which minimizes the 0-1 classification error, depends on the probability ğ‘(â„“= 1|ğ‘§), which is Ë†â„“âˆ—(ğ‘§) =

sign (2ğ‘(â„“= 1|ğ‘§) âˆ’1). The Bayes consistency result (Bartlett et al., 2006; Rosasco et al., 2004) state

the following.

Theorem 2. (Bayes consistency) Assume ğ‘“is convex, and continuously differentiable and ğ‘“â€²(0) < 0.

Then let Ë†â„“(ğ‘§) be the global minimizer to the binary classification loss, then sign



Ë†â„“(ğ‘§)



= Ë†â„“âˆ—(ğ‘§).

We refer readers to Rosasco et al. (2004) for the easy-to-follow proof. The high level idea is to show

that at the global minimizer, assuming ğ‘(â„“= 1|ğ‘§) > 1/2, we should expect Ë†â„“(ğ‘§) > 0. Intuitively, this

should be the case since ğ‘“â€²(0) < 0 and is convex, so the minimizer should be at the right hand side of

the origin.

C.1. Discussion of pairwise preference model

We now discuss properties of the pairwise preference model, where the prediction Ë†â„“(ğ‘¦1, ğ‘¦2) is parame-

terized as a general bi-variate function Ë†â„“(ğ‘¦1, ğ‘¦2) = ğ‘Ÿğœ™(ğ‘¦1, ğ‘¦2) of ğ‘¦1, ğ‘¦2 rather than the difference of two

univariate functions ğ‘Ÿğœ™(ğ‘¦1) âˆ’ğ‘Ÿğœ™(ğ‘¦2). We conjecture that some of the results will transfer to pointwise

reward models in practice, e.g., when the BT assumption approximately makes sense. Making precise

of such approximations is left to future work.

An intuitive requirement for the prediction Ë†â„“(ğ‘¦1, ğ‘¦2) is that it gets the sign of the preference correct,

which is defined through ğ‘(ğ‘¦1 â‰»ğ‘¦2). More concretely, one might seek the follow property

sign



Ë†â„“(ğ‘¦1, ğ‘¦2)



= sign (ğ‘(ğ‘¦1 â‰»ğ‘¦2) âˆ’1/2)

(9)

Interestingly, the right-hand side of Eqn (9) corresponds to the Bayes optimal classifier, which

minimizes the classification loss in Eqn (5). The convex loss functions we consider in this work

(e.g., all examples in Table 1) all satisfy the property that if ğ‘™(ğ‘¦1, ğ‘¦2) is parameterized as a general

preference model (rather than a pointwise reward model, see e.g., (Munos et al., 2024)), then by

minimizing the loss we find Ë†â„“(ğ‘¦1, ğ‘¦2) that satisfies Eqn (9), a result stemming from Bayes consistency

(Bartlett et al., 2006; Rosasco et al., 2004).

24

## Page 25

Generalized Preference Optimization: A Unified Approach to Offline Alignment

However, even if different loss functions produce the same sign, the predictions Ë†â„“(ğ‘¦1, ğ‘¦2) can differ

drastically depending on ğ‘“. In the main paper we have provided a case study example of logistic loss

vs. hinge loss, borrowing inspirations from the study in Hastie et al. (2009).

25
