{
  "dashboard": {
    "id": "waf-security-monitoring",
    "title": "ACGS-PGP WAF Security Monitoring",
    "description": "Real-time monitoring of WAF security rules and attack patterns",
    "version": "1.0.0",
    "created": "2025-01-29",
    "refresh_interval": "30s",
    "time_range": {
      "from": "now-24h",
      "to": "now"
    }
  },
  "panels": [
    {
      "id": "overview-stats",
      "title": "WAF Overview Statistics",
      "type": "stat",
      "position": {
        "x": 0,
        "y": 0,
        "w": 24,
        "h": 4
      },
      "targets": [
        {
          "metric": "waf_requests_total",
          "label": "Total Requests",
          "color": "blue"
        },
        {
          "metric": "waf_blocked_requests_total",
          "label": "Blocked Requests",
          "color": "red"
        },
        {
          "metric": "waf_allowed_requests_total", 
          "label": "Allowed Requests",
          "color": "green"
        },
        {
          "metric": "waf_false_positives_total",
          "label": "False Positives",
          "color": "orange"
        }
      ]
    },
    {
      "id": "attack-patterns-timeline",
      "title": "Attack Patterns Over Time",
      "type": "timeseries",
      "position": {
        "x": 0,
        "y": 4,
        "w": 12,
        "h": 8
      },
      "targets": [
        {
          "metric": "waf_rule_matches_total",
          "group_by": ["rule_id", "rule_name"],
          "legend": "{{rule_name}} ({{rule_id}})"
        }
      ],
      "legend": {
        "show": true,
        "position": "bottom"
      }
    },
    {
      "id": "top-blocked-ips",
      "title": "Top Blocked IP Addresses",
      "type": "table",
      "position": {
        "x": 12,
        "y": 4,
        "w": 12,
        "h": 8
      },
      "targets": [
        {
          "metric": "waf_blocked_requests_total",
          "group_by": ["client_ip"],
          "order_by": "value",
          "limit": 10
        }
      ],
      "columns": [
        {
          "field": "client_ip",
          "title": "IP Address"
        },
        {
          "field": "value",
          "title": "Blocked Requests"
        },
        {
          "field": "last_seen",
          "title": "Last Seen"
        }
      ]
    },
    {
      "id": "rule-effectiveness",
      "title": "WAF Rule Effectiveness",
      "type": "bar",
      "position": {
        "x": 0,
        "y": 12,
        "w": 12,
        "h": 8
      },
      "targets": [
        {
          "metric": "waf_rule_matches_total",
          "group_by": ["rule_id"],
          "time_range": "24h"
        }
      ],
      "options": {
        "orientation": "horizontal",
        "show_values": true
      }
    },
    {
      "id": "response-time-impact",
      "title": "WAF Response Time Impact",
      "type": "timeseries",
      "position": {
        "x": 12,
        "y": 12,
        "w": 12,
        "h": 8
      },
      "targets": [
        {
          "metric": "waf_response_time_ms",
          "aggregation": "avg",
          "label": "Average Response Time"
        },
        {
          "metric": "waf_processing_time_ms",
          "aggregation": "avg", 
          "label": "WAF Processing Time"
        }
      ],
      "y_axis": {
        "unit": "ms",
        "min": 0
      }
    },
    {
      "id": "attack-categories",
      "title": "Attack Categories Distribution",
      "type": "pie",
      "position": {
        "x": 0,
        "y": 20,
        "w": 8,
        "h": 8
      },
      "targets": [
        {
          "metric": "waf_blocked_requests_total",
          "group_by": ["attack_category"],
          "time_range": "24h"
        }
      ],
      "legend": {
        "show": true,
        "position": "right"
      }
    },
    {
      "id": "geographic-distribution",
      "title": "Attack Geographic Distribution",
      "type": "worldmap",
      "position": {
        "x": 8,
        "y": 20,
        "w": 8,
        "h": 8
      },
      "targets": [
        {
          "metric": "waf_blocked_requests_total",
          "group_by": ["country_code"],
          "time_range": "24h"
        }
      ]
    },
    {
      "id": "critical-alerts",
      "title": "Critical Security Alerts",
      "type": "logs",
      "position": {
        "x": 16,
        "y": 20,
        "w": 8,
        "h": 8
      },
      "targets": [
        {
          "query": "level:critical AND component:waf",
          "limit": 50
        }
      ],
      "options": {
        "show_timestamp": true,
        "show_level": true,
        "auto_refresh": true
      }
    }
  ],
  "alerts": [
    {
      "id": "high-volume-attack",
      "name": "High Volume Attack Detected",
      "condition": "waf_blocked_requests_total > 1000 in 5m",
      "severity": "critical",
      "notification_channels": ["slack-security", "email-oncall"],
      "message": "WAF detected high volume attack: {{value}} blocked requests in 5 minutes"
    },
    {
      "id": "new-attack-pattern",
      "name": "New Attack Pattern Detected", 
      "condition": "increase(waf_unique_attack_signatures[1h]) > 10",
      "severity": "high",
      "notification_channels": ["slack-security"],
      "message": "WAF detected {{value}} new attack patterns in the last hour"
    },
    {
      "id": "false-positive-spike",
      "name": "False Positive Rate Spike",
      "condition": "waf_false_positive_rate > 0.05",
      "severity": "medium",
      "notification_channels": ["slack-devops"],
      "message": "WAF false positive rate is {{value}}% - review rules needed"
    },
    {
      "id": "waf-performance-degradation",
      "name": "WAF Performance Degradation",
      "condition": "waf_processing_time_ms > 100",
      "severity": "medium",
      "notification_channels": ["slack-devops"],
      "message": "WAF processing time increased to {{value}}ms"
    }
  ],
  "variables": [
    {
      "name": "time_range",
      "type": "interval",
      "options": ["5m", "15m", "1h", "6h", "24h", "7d"],
      "default": "1h"
    },
    {
      "name": "rule_category",
      "type": "query",
      "query": "label_values(waf_rule_matches_total, category)",
      "multi": true,
      "include_all": true
    },
    {
      "name": "client_ip",
      "type": "query", 
      "query": "label_values(waf_requests_total, client_ip)",
      "multi": true,
      "include_all": true
    }
  ],
  "annotations": [
    {
      "name": "WAF Rule Deployments",
      "query": "waf_rule_deployment_events",
      "color": "blue",
      "icon": "cloud"
    },
    {
      "name": "Security Incidents",
      "query": "security_incident_events",
      "color": "red", 
      "icon": "exclamation-triangle"
    }
  ],
  "export_options": {
    "formats": ["json", "pdf", "png"],
    "schedule": {
      "daily_report": {
        "time": "08:00",
        "recipients": ["security-team@acgs-pgp.com"],
        "format": "pdf"
      },
      "weekly_summary": {
        "day": "monday",
        "time": "09:00",
        "recipients": ["management@acgs-pgp.com"],
        "format": "pdf"
      }
    }
  }
}
