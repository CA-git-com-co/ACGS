# DGM Service Cache Configuration
# Redis-based multi-tier caching with constitutional compliance

# Redis Connection Settings
redis:
  url: 'redis://localhost:6379/7'
  max_connections: 50
  retry_on_timeout: true
  socket_timeout: 5
  socket_connect_timeout: 5
  health_check_interval: 30

  # Connection pool settings
  connection_pool:
    max_connections: 50
    retry_on_timeout: true
    retry_on_error: [ConnectionError, TimeoutError]
    retry_delay: 1.0
    max_retries: 3

# Cache Manager Settings
cache_manager:
  max_memory_cache_size: 1000
  default_ttl: 3600 # 1 hour
  constitutional_hash: 'cdd01ef066bc6cf2'
  hmac_secret: '${DGM_CACHE_SECRET:-dgm-cache-secret}'
  cache_strategy: 'adaptive'

  # Circuit breaker settings
  circuit_breaker:
    failure_threshold: 5
    recovery_timeout: 30
    half_open_max_calls: 3

# Cache Type Configurations
cache_types:
  performance_metrics:
    ttl: 3600 # 1 hour
    strategy: 'write_through'
    compression: true
    tier: 'l2_redis'
    max_size: 10000
    eviction_policy: 'lru'

  archive_entries:
    ttl: 86400 # 24 hours
    strategy: 'write_back'
    compression: true
    tier: 'l2_redis'
    max_size: 5000
    eviction_policy: 'lru'

  bandit_states:
    ttl: 1800 # 30 minutes
    strategy: 'write_through'
    compression: false
    tier: 'l1_memory'
    max_size: 1000
    eviction_policy: 'lru'

  constitutional_compliance:
    ttl: 21600 # 6 hours
    strategy: 'write_through'
    compression: true
    tier: 'l2_redis'
    max_size: 2000
    eviction_policy: 'lru'

  improvement_workspaces:
    ttl: 7200 # 2 hours
    strategy: 'write_around'
    compression: true
    tier: 'l2_redis'
    max_size: 1000
    eviction_policy: 'lru'

  system_configurations:
    ttl: 43200 # 12 hours
    strategy: 'write_through'
    compression: false
    tier: 'l1_memory'
    max_size: 500
    eviction_policy: 'lru'

# Performance Metrics Cache Settings
performance_cache:
  aggregation_windows:
    '1m': 60 # 1 minute
    '5m': 300 # 5 minutes
    '15m': 900 # 15 minutes
    '1h': 3600 # 1 hour
    '1d': 86400 # 1 day

  retention:
    raw_metrics: 3600 # 1 hour
    aggregated_1m: 86400 # 1 day
    aggregated_5m: 604800 # 1 week
    aggregated_15m: 2592000 # 1 month
    aggregated_1h: 7776000 # 3 months
    aggregated_1d: 31536000 # 1 year

  cleanup:
    enabled: true
    interval: 3600 # 1 hour
    batch_size: 1000

# Bandit State Cache Settings
bandit_cache:
  ttl_config:
    active_states: 1800 # 30 minutes
    historical: 7200 # 2 hours
    aggregated: 3600 # 1 hour

  safety:
    default_threshold: 0.8
    violation_alert: true
    auto_disable_unsafe: true

  indexing:
    context_index_ttl: 1800
    access_tracking: true
    access_tracking_ttl: 3600

# Monitoring and Metrics
monitoring:
  prometheus:
    enabled: true
    metrics_prefix: 'dgm_cache'

  logging:
    level: 'INFO'
    log_cache_operations: false
    log_performance_metrics: true
    log_errors: true

  health_checks:
    enabled: true
    interval: 30
    timeout: 5

  alerts:
    hit_rate_threshold: 80.0
    error_rate_threshold: 5.0
    latency_threshold_ms: 100.0

# Security Settings
security:
  encryption:
    enabled: false
    algorithm: 'AES-256-GCM'
    key_rotation_interval: 86400 # 1 day

  integrity:
    hmac_validation: true
    constitutional_validation: true

  access_control:
    require_authentication: false
    allowed_operations: ['get', 'set', 'delete', 'exists']

# Backup and Recovery
backup:
  enabled: true
  interval: 3600 # 1 hour
  retention_days: 7
  compression: true

recovery:
  auto_recovery: true
  fallback_to_memory: true
  recovery_timeout: 30

# Development and Testing
development:
  mock_redis: false
  test_database: 15
  debug_logging: false

testing:
  use_fake_redis: true
  reset_between_tests: true
  test_data_ttl: 60

# Environment-specific overrides
environments:
  development:
    redis:
      url: 'redis://localhost:6379/7'
    cache_manager:
      max_memory_cache_size: 500
    monitoring:
      logging:
        level: 'DEBUG'
        log_cache_operations: true

  testing:
    redis:
      url: 'redis://localhost:6379/15'
    cache_manager:
      max_memory_cache_size: 100
    testing:
      use_fake_redis: true

  production:
    redis:
      url: '${REDIS_URL}'
      max_connections: 100
    cache_manager:
      max_memory_cache_size: 2000
    security:
      encryption:
        enabled: true
      integrity:
        hmac_validation: true
    monitoring:
      alerts:
        hit_rate_threshold: 85.0
        error_rate_threshold: 2.0

# Feature Flags
features:
  multi_tier_caching: true
  compression: true
  integrity_validation: true
  constitutional_compliance: true
  performance_monitoring: true
  automatic_cleanup: true
  circuit_breaker: true
  health_checks: true
