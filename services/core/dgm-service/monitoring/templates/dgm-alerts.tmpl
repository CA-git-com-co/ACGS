{{ define "__dgm_alert_title" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] DGM Service Alert
{{ end }}

{{ define "__dgm_alert_text" }}
{{ range .Alerts }}
{{ if .Annotations.summary }}**Summary:** {{ .Annotations.summary }}{{ end }}
{{ if .Annotations.description }}**Description:** {{ .Annotations.description }}{{ end }}
**Service:** {{ .Labels.service }}
**Component:** {{ .Labels.component }}
**Severity:** {{ .Labels.severity }}
{{ if .Annotations.runbook_url }}**Runbook:** {{ .Annotations.runbook_url }}{{ end }}
**Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .EndsAt }}**Ended:** {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
---
{{ end }}
{{ end }}

{{ define "__dgm_critical_title" }}
🚨 CRITICAL DGM ALERT 🚨
{{ end }}

{{ define "__dgm_critical_text" }}
<!channel> **CRITICAL ALERT DETECTED**

{{ range .Alerts }}
🔥 **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
🏷️ **Service:** {{ .Labels.service }} | **Component:** {{ .Labels.component }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .Annotations.runbook_url }}📖 **Runbook:** {{ .Annotations.runbook_url }}{{ end }}

{{ end }}
**Action Required:** Immediate investigation and resolution needed.
{{ end }}

{{ define "__dgm_constitutional_title" }}
⚖️ Constitutional Compliance Alert
{{ end }}

{{ define "__dgm_constitutional_text" }}
<!here> **Constitutional compliance issue detected**

{{ range .Alerts }}
⚖️ **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
🏛️ **Principle:** {{ .Labels.principle }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .Annotations.runbook_url }}📖 **Runbook:** {{ .Annotations.runbook_url }}{{ end }}

{{ end }}
**Note:** This may require constitutional review and governance team involvement.
{{ end }}

{{ define "__dgm_performance_title" }}
📊 DGM Performance Alert
{{ end }}

{{ define "__dgm_performance_text" }}
{{ range .Alerts }}
📊 **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
🎯 **Service:** {{ .Labels.service }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .Annotations.runbook_url }}📖 **Runbook:** {{ .Annotations.runbook_url }}{{ end }}

{{ end }}
{{ end }}

{{ define "__dgm_security_title" }}
🔒 DGM Security Alert
{{ end }}

{{ define "__dgm_security_text" }}
{{ range .Alerts }}
🔒 **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
🛡️ **Component:** {{ .Labels.component }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .Annotations.runbook_url }}📖 **Runbook:** {{ .Annotations.runbook_url }}{{ end }}

{{ end }}
**Security team has been notified.**
{{ end }}

{{ define "__dgm_database_title" }}
🗄️ DGM Database Alert
{{ end }}

{{ define "__dgm_database_text" }}
{{ range .Alerts }}
🗄️ **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
💾 **Operation:** {{ .Labels.operation }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .Annotations.runbook_url }}📖 **Runbook:** {{ .Annotations.runbook_url }}{{ end }}

{{ end }}
{{ end }}

{{ define "__dgm_model_title" }}
🤖 DGM Model Alert
{{ end }}

{{ define "__dgm_model_text" }}
{{ range .Alerts }}
🤖 **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
🏢 **Provider:** {{ .Labels.provider }}
🧠 **Model:** {{ .Labels.model }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .Annotations.runbook_url }}📖 **Runbook:** {{ .Annotations.runbook_url }}{{ end }}

{{ end }}
{{ end }}

{{ define "__dgm_info_title" }}
ℹ️ DGM Information
{{ end }}

{{ define "__dgm_info_text" }}
{{ range .Alerts }}
ℹ️ **{{ .Annotations.summary }}**
📝 {{ .Annotations.description }}
⏰ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}

{{ end }}
{{ end }}

{{ define "__dgm_resolved_title" }}
✅ DGM Alert Resolved
{{ end }}

{{ define "__dgm_resolved_text" }}
{{ range .Alerts }}
✅ **Resolved:** {{ .Annotations.summary }}
📝 {{ .Annotations.description }}
⏰ **Duration:** {{ .StartsAt.Format "2006-01-02 15:04:05" }} - {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}

{{ end }}
{{ end }}

{{ define "dgm.slack.title" }}{{ template "__dgm_alert_title" . }}{{ end }}
{{ define "dgm.slack.text" }}{{ template "__dgm_alert_text" . }}{{ end }}

{{ define "dgm.critical.slack.title" }}{{ template "__dgm_critical_title" . }}{{ end }}
{{ define "dgm.critical.slack.text" }}{{ template "__dgm_critical_text" . }}{{ end }}

{{ define "dgm.constitutional.slack.title" }}{{ template "__dgm_constitutional_title" . }}{{ end }}
{{ define "dgm.constitutional.slack.text" }}{{ template "__dgm_constitutional_text" . }}{{ end }}

{{ define "dgm.performance.slack.title" }}{{ template "__dgm_performance_title" . }}{{ end }}
{{ define "dgm.performance.slack.text" }}{{ template "__dgm_performance_text" . }}{{ end }}

{{ define "dgm.security.slack.title" }}{{ template "__dgm_security_title" . }}{{ end }}
{{ define "dgm.security.slack.text" }}{{ template "__dgm_security_text" . }}{{ end }}

{{ define "dgm.database.slack.title" }}{{ template "__dgm_database_title" . }}{{ end }}
{{ define "dgm.database.slack.text" }}{{ template "__dgm_database_text" . }}{{ end }}

{{ define "dgm.model.slack.title" }}{{ template "__dgm_model_title" . }}{{ end }}
{{ define "dgm.model.slack.text" }}{{ template "__dgm_model_text" . }}{{ end }}

{{ define "dgm.info.slack.title" }}{{ template "__dgm_info_title" . }}{{ end }}
{{ define "dgm.info.slack.text" }}{{ template "__dgm_info_text" . }}{{ end }}

{{ define "dgm.resolved.slack.title" }}{{ template "__dgm_resolved_title" . }}{{ end }}
{{ define "dgm.resolved.slack.text" }}{{ template "__dgm_resolved_text" . }}{{ end }}

<!-- Email templates -->
{{ define "dgm.email.subject" }}
DGM Service Alert: {{ .GroupLabels.alertname }} - {{ .Status | toUpper }}
{{ end }}

{{ define "dgm.email.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DGM Service Alert</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .alert { border-left: 4px solid #ff6b6b; padding: 15px; margin: 10px 0; background: #fff5f5; }
        .alert.warning { border-color: #ffa726; background: #fff8e1; }
        .alert.info { border-color: #42a5f5; background: #e3f2fd; }
        .alert.resolved { border-color: #66bb6a; background: #e8f5e8; }
        .header { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .details { margin: 10px 0; }
        .label { font-weight: bold; }
        .runbook { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="header">DGM Service Alert - {{ .Status | toUpper }}</div>
    
    {{ range .Alerts }}
    <div class="alert {{ .Labels.severity }}">
        <div class="details">
            <div><span class="label">Summary:</span> {{ .Annotations.summary }}</div>
            <div><span class="label">Description:</span> {{ .Annotations.description }}</div>
            <div><span class="label">Service:</span> {{ .Labels.service }}</div>
            <div><span class="label">Component:</span> {{ .Labels.component }}</div>
            <div><span class="label">Severity:</span> {{ .Labels.severity }}</div>
            <div><span class="label">Started:</span> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</div>
            {{ if .EndsAt }}<div><span class="label">Ended:</span> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}</div>{{ end }}
        </div>
        {{ if .Annotations.runbook_url }}
        <div class="runbook">
            <span class="label">Runbook:</span> <a href="{{ .Annotations.runbook_url }}">{{ .Annotations.runbook_url }}</a>
        </div>
        {{ end }}
    </div>
    {{ end }}
</body>
</html>
{{ end }}
